/*----------------------------------------------------------------------* 
 * Copyright  (c) 2014 SAP SE. All rights reserved	
 * Author       : SAP Custom Development 
 *----------------------------------------------------------------------*/ 
	!function(){"use strict";jQuery.sap.require({modName:"com.zespri.awct.core.Controller",type:"controller"}),jQuery.sap.require("com.zespri.awct.util.CommonHelper"),jQuery.sap.require("com.zespri.awct.util.I18NHelper"),jQuery.sap.require("com.zespri.awct.util.CommonFormatHelper"),jQuery.sap.require("com.zespri.awct.util.LocaleFormatHelper"),jQuery.sap.require("com.zespri.awct.util.NotificationHelper"),jQuery.sap.require("com.zespri.awct.util.ModelHelper"),com.zespri.awct.core.Controller.extend("com.zespri.awct.alloc.view.SupplyPlan",{onInit:function(){this._oFilter=null,this._sDeliveryLineID=null,this.oDeliveryLineIDFilter=null,this._bUserAuthorized=!1,this._sLastSelectedKey="ViewAllocationShare";var a=this,b=this.byId("viewAllocationShareTable"),c=this.byId("viewRatioPerSizeTable"),d=this.byId("facetFilterSupplyPlan");com.zespri.awct.util.CommonHelper.manageFacetFilterState(b,d),com.zespri.awct.util.CommonHelper.manageFacetFilterState(c,d),com.zespri.awct.util.CommonHelper.manageNoDataText(b),com.zespri.awct.util.CommonHelper.manageNoDataText(c),this.getRouter().attachRoutePatternMatched(function(d){if("Allocation/SupplyPlan"===d.getParameter("name"))if(a._bUserAuthorized){var e=d.getParameter("arguments");if(e&&e.DeliveryLineID){a.getView().setBusy(!1),a._sDeliveryLineID=e.DeliveryLineID,a.oDeliveryLineIDFilter=new sap.ui.model.Filter("DeliveryLineID",sap.ui.model.FilterOperator.EQ,a._sDeliveryLineID),sap.ui.getCore().getRootComponent().getModel().read("/GetSupplyPlanParameters",{urlParameters:{DeliveryLineID:"'"+a._sDeliveryLineID+"'"},success:function(b){b.GetSupplyPlanParameters.DeliveryLineID=a._sDeliveryLineID;var c=new sap.ui.model.json.JSONModel;c.setData(b.GetSupplyPlanParameters),a.byId("supplyPlanObjectHeader").setModel(c)},error:function(a){com.zespri.awct.util.NotificationHelper.handleErrorMessage(a)}});var f=null,g={};switch(a.byId("supplyPlanIconTabBar").getSelectedKey()){case"ViewAllocationShare":f=b,this.byId("facetFilterListSize").setEnabled(!1),this.byId("facetFilterListPeriod").setEnabled(!0),g={path:"/SupplyPlanAllocationShareSet",template:b.getBindingInfo("items")?b.getBindingInfo("items").template:b.getItems()[0].clone(),filters:[this.oDeliveryLineIDFilter]};break;case"ViewRatioPerSize":f=c,this.byId("facetFilterListSize").setEnabled(!0),this.byId("facetFilterListPeriod").setEnabled(!1),g={path:"/SupplyPlanRatioSet",template:c.getBindingInfo("items")?c.getBindingInfo("items").template:c.getItems()[0].clone(),filters:[this.oDeliveryLineIDFilter]}}f.bindAggregation("items",g)}else com.zespri.awct.util.NotificationHelper.showErrorToast(com.zespri.awct.util.I18NHelper.getText("TXT_ALLCOATION_SUPPLY_PLAN_NO_DELIVERY_LINE_ID_ERROR_TEXT")),a.getView().setBusy(!0)}else com.zespri.awct.util.NotificationHelper.showErrorToast(com.zespri.awct.util.I18NHelper.getText("TXT_USER_NOT_AUTHORIZED_MESSAGE_TEXT"))},this)},onBeforeRendering:function(){com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Display,com.zespri.awct.util.Enums.AuthorizationObject.Allocation,com.zespri.awct.util.Enums.AuthorizationFunctions.ZESP)?this._bUserAuthorized=!0:(this.byId("pageSupplyPlan")&&this.byId("pageSupplyPlan").destroy(),this._bUserAuthorized=!1)},handleListOpen:function(a){var b=a.getSource().getKey(),c={};switch(b){case"Season":c.facetListControl=this.byId("facetFilterListSupplyPlanSeason"),c.entitySetName="GenericSearchSet",c.filterString="Scenario eq 'SEASON'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!1);break;case"Supplier":c.facetListControl=this.byId("facetFilterListSupplyPlanSupplier"),c.entitySetName="SupplierSet",c.selectString="SupplierID",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!1);break;case"SizeCode":c.facetListControl=this.byId("facetFilterListSize"),c.entitySetName="GenericSearchSet",c.filterString="Scenario eq 'SIZE'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!1);break;case"SupplyPeriod":c.facetListControl=this.byId("facetFilterListPeriod"),c.entitySetName="GetSupplyPeriodsForSeason",c.urlParameter={Season:"'"+sap.ui.getCore().getRootComponent().getApplicationParameters().CurrentSeason+"'"},com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!1)}},handleListClose:function(){var a=this.byId("facetFilterSupplyPlan");a.getFiltersModifiedAfterListOpen()&&this._applyFacetFilters(!0)},handleFacetFilterReset:function(){for(var a=this.byId("facetFilterSupplyPlan"),b=a.getLists(),c=0;c<b.length;c++)b[c].setSelectedKeys();var d=this._getCurrentTable();d.getBinding("items").filter([this.oDeliveryLineIDFilter],sap.ui.model.FilterType.Application),this._oFilter=null},_getCurrentTable:function(){var a=null;switch(this.byId("supplyPlanIconTabBar").getSelectedKey()){case"ViewAllocationShare":a=this.byId("viewAllocationShareTable");break;case"ViewRatioPerSize":a=this.byId("viewRatioPerSizeTable")}return a},handleNavigateToAnotherTab:function(){var a=this,b=this.byId("facetFilterListPeriod"),c=this.byId("facetFilterListSize");if("ViewRatioPerSize"===a.byId("supplyPlanIconTabBar").getSelectedKey()&&"ViewRatioPerSize"!==this._sLastSelectedKey)if(this._sLastSelectedKey="ViewRatioPerSize",c.setEnabled(!0),b.setEnabled(!1),a.byId("viewRatioPerSizeTable").getBinding("items"))this._applyFacetFilters(!0);else{var d={path:"/SupplyPlanRatioSet",template:a.byId("viewRatioPerSizeTable").getBindingInfo("items")?a.byId("viewRatioPerSizeTable").getBindingInfo("items").template:a.byId("viewRatioPerSizeTable").getItems()[0].clone()};this._applyFacetFilters(!1),d.filters=this._oFilter?[this._oFilter]:[this.oDeliveryLineIDFilter],a.byId("viewRatioPerSizeTable").bindAggregation("items",d)}else{if("ViewAllocationShare"!==a.byId("supplyPlanIconTabBar").getSelectedKey()||"ViewAllocationShare"===this._sLastSelectedKey)return;this._sLastSelectedKey="ViewAllocationShare",b.setEnabled(!0),c.setEnabled(!1),this._applyFacetFilters(!0)}this.byId("facetFilterSupplyPlan").rerender()},_applyFacetFilters:function(a){var b=this._getCurrentTable(),c=this,d=this.byId("facetFilterSupplyPlan"),e=d.getLists().filter(function(a){return"ViewRatioPerSize"===c.byId("supplyPlanIconTabBar").getSelectedKey()&&"SupplyPeriod"!==a.getKey()||"ViewAllocationShare"===c.byId("supplyPlanIconTabBar").getSelectedKey()&&"SizeCode"!==a.getKey()?a.getActive()&&a.getSelectedItems().length:void 0}),f=new sap.ui.model.Filter(e.map(function(a){return new sap.ui.model.Filter(a.getSelectedItems().map(function(b){var c=a.getKey(),d=b.getKey(),e=new sap.ui.model.Filter(c,"EQ",d);return e}),!1)}),!0),g;f.aFilters.length?g=new sap.ui.model.Filter([this.oDeliveryLineIDFilter,f],!0):(f=null,g=this.oDeliveryLineIDFilter),a&&b.getBinding("items").filter(g,sap.ui.model.FilterType.Application),this._oFilter=g},handleObjectHeaderTitlePress:function(){var a=this.byId("supplyPlanObjectHeader"),b=a.getCondensed();a.setCondensed(!b)}})}();