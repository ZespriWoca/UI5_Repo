/*----------------------------------------------------------------------* 
 * Copyright  (c) 2014 SAP SE. All rights reserved	
 * Author       : SAP Custom Development 
 *----------------------------------------------------------------------*/ 
	!function(){"use strict";jQuery.sap.require({modName:"com.zespri.awct.core.Controller",type:"controller"}),jQuery.sap.require("com.zespri.awct.util.CommonHelper"),jQuery.sap.require("com.zespri.awct.util.I18NHelper"),jQuery.sap.require("com.zespri.awct.util.LocaleFormatHelper"),jQuery.sap.require("com.zespri.awct.util.ModelHelper"),jQuery.sap.require("com.zespri.awct.util.NotificationHelper"),com.zespri.awct.core.Controller.extend("com.zespri.awct.alloc.view.DeliverySwapListing",{onInit:function(){this._oViewSettingsDialog=null,this._bUserAuthorized=!1;var a=this,b=this.byId("deliverySwapListTable"),c=this.byId("facetFilterDeliverySwap");com.zespri.awct.util.CommonHelper.manageFacetFilterState(b,c),com.zespri.awct.util.CommonHelper.manageNoDataText(b),this.getRouter().attachRoutePatternMatched(function(b){if("Allocation/DeliverySwapListing"===b.getParameter("name")){if(!a._bUserAuthorized)return void com.zespri.awct.util.NotificationHelper.showErrorToast(com.zespri.awct.util.I18NHelper.getText("TXT_USER_NOT_AUTHORIZED_MESSAGE_TEXT"));com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Maintain,com.zespri.awct.util.Enums.AuthorizationObject.Allocation,com.zespri.awct.util.Enums.AuthorizationFunctions.ZESP)||a.byId("deliverySwapPage").getFooter()&&a.byId("deliverySwapPage").getFooter().destroy()}})},onBeforeRendering:function(){com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Display,com.zespri.awct.util.Enums.AuthorizationObject.Allocation,com.zespri.awct.util.Enums.AuthorizationFunctions.ZESP)?(this._bUserAuthorized=!0,this._bindItemsToSeasonFacetList()):(this.byId("deliverySwapPage")&&this.byId("deliverySwapPage").destroy(),this._bUserAuthorized=!1)},_refreshTable:function(){var a=this.byId("deliverySwapListTable"),b=this.byId("facetFilterDeliverySwap").getLists(),c=this,d=[],e=[];$.each(b,function(a,b){if(b.getSelectedItems().length>0){var e=[];$.each(b.getSelectedItems(),function(a,d){e.push(b===c.byId("facetFilterListDateWeekFrom")?new sap.ui.model.Filter(b.getKey(),"GT",d.getKey()):b===c.byId("facetFilterListDateWeekTo")?new sap.ui.model.Filter(b.getKey(),"LT",d.getKey()):new sap.ui.model.Filter(b.getKey(),"EQ",d.getKey()))}),d.push(new sap.ui.model.Filter(e,!1))}}),d.length>0&&e.push(new sap.ui.model.Filter(d,!0));var f={path:"/DeliverySwapSet",template:a.getBindingInfo("items")?a.getBindingInfo("items").template:a.getItems()[0].clone(),filters:e};a.bindItems(f)},handleTableItemPress:function(a){var b=a.getSource().getSelectedItem().getBindingContext();this.getRouter().navTo("Allocation/DeliverySwapDetails",{contextPath:b.getPath().substr(1)})},handeleNavToSwapCreate:function(){this.getRouter().navTo("Allocation/DeliverySwapCreate")},_bindItemsToSeasonFacetList:function(){var a=sap.ui.getCore().getRootComponent().getApplicationParameters().CurrentSeason,b=this,c=this.byId("facetFilterListSeason");c.setBusy(!0);var d={};c.getBinding("items")?(d[a]=a,c.getItems().length&&c.setSelectedKeys(d),c.setBusy(!1),b._refreshTable()):com.zespri.awct.util.ModelHelper.getJSONModelForRead("/GenericSearchSet",{urlParameters:{$filter:"Scenario eq 'SEASON'"}},function(e){c.setModel(e),c.bindItems({path:"/results",template:c.getBindingInfo("items")?c.getBindingInfo("items").template:c.getItems()[0].clone()}),d[a]=a,c.getItems().length&&c.setSelectedKeys(d),c.setBusy(!1),b._refreshTable()})},handleFacetFilterOpen:function(a){var b=a.getSource().getKey(),c=sap.ui.getCore().getRootComponent().getApplicationParameters().CurrentSeason,d=this.byId("facetFilterListSeason").getSelectedItem(),e,f={};e=d?d.getKey():c,"SourceShipmentID"===b?(f.facetListControl=this.byId("facetFilterListShipmentFrom"),f.entitySetName="ShipmentSet",f.filterString="Season eq '"+e+"'",f.selectString="ShipmentID",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(f,!1)):"TargetShipmentID"===b&&(f.facetListControl=this.byId("facetFilterListShipmentTo"),f.entitySetName="ShipmentSet",f.filterString="Season eq '"+e+"'",f.selectString="ShipmentID",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(f,!1))},handleFacetFilterClose:function(){var a=this.byId("facetFilterDeliverySwap"),b=a.getFiltersModifiedAfterListOpen();b&&(this.byId("deliverySwapListTable").setBusy(!0),this._refreshTable())},handleFacetFilterReset:function(){var a=this.byId("facetFilterDeliverySwap"),b=a.getLists(),c=this;jQuery.each(b,function(a,b){b!==c.byId("facetFilterListSeason")&&b.setSelectedKeys()}),this._bindItemsToSeasonFacetList()},handleViewSettingsDialogOpen:function(){this._oViewSettingsDialog||(this._oViewSettingsDialog=sap.ui.xmlfragment("com.zespri.awct.alloc.fragment.DeliverySwapSettingsDialog",this),this.getView().addDependent(this._oViewSettingsDialog)),this._oViewSettingsDialog.open()},handleViewSettingsDialogClose:function(a){var b=a.getParameters(),c=[];if(b.sortItem){var d=b.sortItem.getKey(),e=b.sortDescending;c.push(new sap.ui.model.Sorter(d,e));var f=this.byId("deliverySwapListTable"),g=f.getBinding("items");g.sort(c)}}})}();