/*----------------------------------------------------------------------* 
 * Copyright  (c) 2014 SAP SE. All rights reserved	
 * Author       : SAP Custom Development 
 *----------------------------------------------------------------------*/ 
	!function(){"use strict";jQuery.sap.require({modName:"com.zespri.awct.core.Controller",type:"controller"}),jQuery.sap.require("com.zespri.awct.util.CommonFormatHelper"),jQuery.sap.require("com.zespri.awct.util.Enums"),jQuery.sap.require("com.zespri.awct.util.I18NHelper"),jQuery.sap.require("com.zespri.awct.util.LocaleFormatHelper"),jQuery.sap.require("com.zespri.awct.util.ModelHelper"),jQuery.sap.require("com.zespri.awct.util.NotificationHelper"),jQuery.sap.require("sap.ui.core.format.NumberFormat"),com.zespri.awct.core.Controller.extend("com.zespri.awct.alloc.view.DeliverySwapDetails",{onInit:function(){this._oDeliverySwapListingContext=null,this._oViewBatchCharacteristicsDialog=null,this._bUserAuthorized=!1;var a=this,b=this.getView();this.getRouter().attachRoutePatternMatched(function(c){if("Allocation/DeliverySwapDetails"===c.getParameter("name")){if(!a._bUserAuthorized)return void com.zespri.awct.util.NotificationHelper.showErrorToast(com.zespri.awct.util.I18NHelper.getText("TXT_USER_NOT_AUTHORIZED_MESSAGE_TEXT"));var d=c.getParameter("arguments").contextPath;this._oDeliverySwapListingContext=new sap.ui.model.Context(b.getModel(),"/"+d);var e=this._oDeliverySwapListingContext.getProperty("DeliverySwapID"),f=!1;if(e)this._bindDeliverySwapLineItems(d,f);else{f=!0;var g=function(b){a._oDeliverySwapListingContext=new sap.ui.model.Context(b,"/result"),a._bindDeliverySwapLineItems(d,f),a.getView().setBusy(!1)},h=function(){com.zespri.awct.util.NotificationHelper.handleErrorMessage(oError),a.getView().setBusy(!1)};this.getView().setBusy(!0),com.zespri.awct.util.ModelHelper.getJSONModelForRead(d,{urlParameters:{$expand:"DeliverySwapLineSet"}},g,h)}}},this)},onBeforeRendering:function(){com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Display,com.zespri.awct.util.Enums.AuthorizationObject.Allocation,com.zespri.awct.util.Enums.AuthorizationFunctions.ZESP)?this._bUserAuthorized=!0:(this.byId("pageSwapDetail")&&this.byId("pageSwapDetail").destroy(),this._bUserAuthorized=!1)},_bindDeliverySwapLineItems:function(a,b){var c=this.byId("deliverySwapDetailsTable"),d="";this.getView().setModel(this._oDeliverySwapListingContext.getModel()).setBindingContext(this._oDeliverySwapListingContext),d=b?"DeliverySwapLineSet/results":"/"+a+"/DeliverySwapLineSet",c.bindAggregation("items",{path:d,template:c.getBindingInfo("items")?c.getBindingInfo("items").template:c.getItems()[0].clone()})},formatIsSupplierLine:function(a,b){return b===com.zespri.awct.util.Enums.AllocationLineRecordType.DeliveryLine?com.zespri.awct.util.I18NHelper.getText("TXT_ALLOCATION_DELIVERYSWAP_COLUMN_SUPPLIER_ID_ALL"):a},handleViewSourceBatchCharacteristicsOpen:function(a){var b=a.getSource().getBindingContext().getProperty("SourceDeliveryLineID");this._openViewBatchCharacteristicsDialog(b)},handleViewTargetBatchCharacteristicsOpen:function(a){var b=a.getSource().getBindingContext().getProperty("TargetDeliveryLineID");this._openViewBatchCharacteristicsDialog(b)},_openViewBatchCharacteristicsDialog:function(a){var b=this,c=function(a){b._oViewBatchCharacteristicsDialog.setModel(a);var c=a.getData().results.length;sap.ui.core.Fragment.byId("viewBatchCharacteristicsFragment","viewBatchCharacteristicsTableHeader").setText(com.zespri.awct.util.I18NHelper.getText("TXT_ALLOCATION_VIEW_BATCH_CHARACTERISTICS_TABLE_TITLE",[c])),b._oViewBatchCharacteristicsDialog.setBusy(!1)},d=function(a){com.zespri.awct.util.NotificationHelper.handleErrorMessage(a),b._oViewBatchCharacteristicsDialog.setBusy(!1)};b._oViewBatchCharacteristicsDialog||(b._oViewBatchCharacteristicsDialog=new sap.ui.xmlfragment("viewBatchCharacteristicsFragment","com.zespri.awct.alloc.fragment.ViewBatchCharacteristics",this),sap.ui.core.Fragment.byId("viewBatchCharacteristicsFragment","viewBCToolBar").setVisible(!1),b.getView().addDependent(b._oViewBatchCharacteristicsDialog)),com.zespri.awct.util.ModelHelper.getJSONModelForRead("/BatchCharacteristicsSet",{urlParameters:{$filter:"DeliveryLineID eq '"+a+"'",$expand:"BatchCharacteristicsValueSet"}},c,d),b._oViewBatchCharacteristicsDialog.setBusy(!0),b._oViewBatchCharacteristicsDialog.open()},handleViewBatchCharacteristicsOKPress:function(){this._oViewBatchCharacteristicsDialog.close()},formatViewBatchCharacteristicsValuesText:function(a){var b=function(a){return a.Value};return a.results.map(b).join(", ")},formatViewBatchCharacteristicsOptionText:function(a){return a===com.zespri.awct.util.Enums.ViewBCOperation.Exclude?com.zespri.awct.util.I18NHelper.getText("TXT_ALLOCATION_VIEW_BATCH_CHARACTERISTICS_EXCLUDE"):a===com.zespri.awct.util.Enums.ViewBCOperation.Include?com.zespri.awct.util.I18NHelper.getText("TXT_ALLOCATION_VIEW_BATCH_CHARACTERISTICS_INCLUDE"):""}})}();