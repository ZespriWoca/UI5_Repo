/*----------------------------------------------------------------------* 
 * Copyright  (c) 2014 SAP SE. All rights reserved	
 * Author       : SAP Custom Development 
 *----------------------------------------------------------------------*/ 
	!function(){"use strict";jQuery.sap.require({modName:"com.zespri.awct.core.Controller",type:"controller"}),jQuery.sap.require("com.zespri.awct.util.I18NHelper"),jQuery.sap.require("com.zespri.awct.util.LocaleFormatHelper"),jQuery.sap.require("com.zespri.awct.util.NotificationHelper"),jQuery.sap.require("com.zespri.awct.util.ModelHelper"),com.zespri.awct.core.Controller.extend("com.zespri.awct.collab.view.DeliverySwapListing",{_oViewSettingsDialog:null,onInit:function(){this._bindItemsToSeasonFacetList()},_refreshTable:function(){var a=this.byId("deliverySwapListTable"),b=this.byId("facetFilterDeliverySwap").getLists(),c=this,d=[],e=[];$.each(b,function(a,b){if(b.getSelectedItems().length>0){var e=[];$.each(b.getSelectedItems(),function(a,d){e.push(b===c.byId("facetFilterListDateWeekFrom")?new sap.ui.model.Filter(b.getKey(),"GT",d.getKey()):b===c.byId("facetFilterListDateWeekTo")?new sap.ui.model.Filter(b.getKey(),"LT",d.getKey()):new sap.ui.model.Filter(b.getKey(),"EQ",d.getKey()))}),d.push(new sap.ui.model.Filter(e,!1))}}),d.length>0&&e.push(new sap.ui.model.Filter(d,!0));var f={path:"/DeliverySwapSet",template:a.getBindingInfo("items")?a.getBindingInfo("items").template:a.getItems()[0].clone(),filters:e};a.bindItems(f)},_bindResultOnSuccess:function(a,b){b.setModel(a),b.bindItems({path:"/results",template:b.getBindingInfo("items")?b.getBindingInfo("items").template:b.getItems()[0].clone()})},handleTableItemPress:function(a){var b=a.getSource().getSelectedItem().getBindingContext();this.getRouter().navTo("Collaboration/DeliverySwapDetails",{contextPath:b.getPath().substr(1)})},handeleNavToSwapCreate:function(){this.getRouter().navTo("Collaboration/DeliverySwapCreate")},_bindItemsToSeasonFacetList:function(){var a=sap.ui.getCore().getRootComponent().getApplicationParameters().CurrentSeason,b=this,c=this.byId("facetFilterListSeason");c.setBusy(!0);var d={};c.getBinding("items")?(d[a]=a,c.getItems().length&&c.setSelectedKeys(d),c.setBusy(!1),b._refreshTable()):com.zespri.awct.util.ModelHelper.getJSONModelForRead("/GenericSearchSet",{urlParameters:{$filter:"Scenario eq 'SEASON'"}},function(e){b._bindResultOnSuccess(e,c),d[a]=a,c.getItems().length&&c.setSelectedKeys(d),c.setBusy(!1),b._refreshTable()})},handleFacetFilterOpen:function(a){var b=a.getSource().getKey(),c=this,d=sap.ui.getCore().getRootComponent().getApplicationParameters().CurrentSeason,e=this.byId("facetFilterListSeason").getSelectedItem(),f;if(f=e?e.getKey():d,"SourceShipmentID"===b){var g=this.byId("facetFilterListShipmentFrom");g.setBusy(!0),g.getBinding("items")?g.setBusy(!1):(g.setBusy(!0),com.zespri.awct.util.ModelHelper.getJSONModelForRead("/ShipmentSet",{urlParameters:{$select:"ShipmentID",$filter:"Season eq '"+f+"'"}},function(a){c._bindResultOnSuccess(a,g),g.setBusy(!1)}))}else if("TargetShipmentID"===b){var h=this.byId("facetFilterListShipmentTo");h.setBusy(!0),h.getBinding("items")?h.setBusy(!1):(h.setBusy(!0),com.zespri.awct.util.ModelHelper.getJSONModelForRead("/ShipmentSet",{urlParameters:{$select:"ShipmentID",$filter:"Season eq '"+f+"'"}},function(a){c._bindResultOnSuccess(a,h),h.setBusy(!1)}))}},handleFacetFilterClose:function(){var a=this.byId("facetFilterDeliverySwap"),b=a.getFiltersModifiedAfterListOpen();b&&(this.byId("deliverySwapListTable").setBusy(!0),this._refreshTable())},handleFacetFilterReset:function(){var a=this.byId("facetFilterDeliverySwap"),b=a.getLists(),c=this;jQuery.each(b,function(a,b){b!==c.byId("facetFilterListSeason")&&b.setSelectedKeys()}),this._bindItemsToSeasonFacetList()},handleViewSettingsDialogOpen:function(){this._oViewSettingsDialog||(this._oViewSettingsDialog=sap.ui.xmlfragment("com.zespri.awct.collab.fragment.DeliverySwapSettingsDialog",this),this._oViewSettingsDialog.setModel(this.getView().getModel()),this._oViewSettingsDialog.setModel(this.getView().getModel("i18n"),"i18n")),this._oViewSettingsDialog.open()},handleViewSettingsDialogClose:function(a){var b=a.getParameters(),c=[];if(b.sortItem){var d=b.sortItem.getKey(),e=b.sortDescending;c.push(new sap.ui.model.Sorter(d,e));var f=this.byId("deliverySwapListTable"),g=f.getBinding("items");g.sort(c)}}})}();