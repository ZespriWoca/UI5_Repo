/*----------------------------------------------------------------------* 
 * Copyright  (c) 2014 SAP SE. All rights reserved	
 * Author       : SAP Custom Development 
 *----------------------------------------------------------------------*/ 
	!function(){"use strict";jQuery.sap.require({modName:"com.zespri.awct.core.Controller",type:"controller"}),jQuery.sap.require("com.zespri.awct.control.FacetFilterDateInputList"),jQuery.sap.require("com.zespri.awct.util.CommonHelper"),jQuery.sap.require("com.zespri.awct.util.Enums"),jQuery.sap.require("com.zespri.awct.util.I18NHelper"),jQuery.sap.require("com.zespri.awct.util.CommonFormatHelper"),jQuery.sap.require("com.zespri.awct.util.LocaleFormatHelper"),jQuery.sap.require("com.zespri.awct.util.ModelHelper"),jQuery.sap.require("com.zespri.awct.util.TableRowActionsExtension"),jQuery.sap.require("com.zespri.awct.util.NotificationHelper"),jQuery.sap.require("sap.ui.commons.layout.HorizontalLayout"),com.zespri.awct.core.Controller.extend("com.zespri.awct.collab.view.TrackOrders",{_AllocationLineRecordType:{DeliveryLine:"D",SupplierOrderLine:"A"},_BusinessAction:{REQUEST:"Request",APPROVE:"Approve",DOWNLOAD:"Download"},_FileType:{CSV:"CSV"},_DeliveryStatus:{BeforeRelease:"B4REL",DeliveryRelease:"REL",DeliveryLock:"LOCK",DeliveryUnlock:"UNLCK",ChangesDuringLock:"COLK",OnUnlockDIFOTIS:"COULK"},onInit:function(){if(this._bSubmitBatchCalled=!1,this._oActionSheet=null,this._aSelectedTrackOrderRowContexts=[],this._aSelectedSupplierLinesRowContexts=[],this._oGrantExemptionDialog=null,this._oBatchGrantExemptionDialog=null,this._oRequestExemptionDialog=null,this._oBatchRequestExemptionDialog=null,this._oSortOrderHistoryTableDialog=null,this._oReasonCodeDescriptionPopover=null,this._mParams=null,this._oFilter=null,this._oTrackLinesDefaultFilter=new sap.ui.model.Filter("RecordType","EQ","D"),this._oSupplierLinesDefaultFilter=new sap.ui.model.Filter("RecordType","EQ","A"),this._oTrackLinesRowActionsExtension=null,this._oSupplierLinesRowActionsExtension=null,this._oRowActionsCommentsButton=null,this._oOrderHistoryCommentsDialog=null,this._oRejectExemptionDialog=null,this._oOrderHistoryDefaultSorter=new sap.ui.model.Sorter("CreationTimestamp",!0),this._oBusyDialog=new sap.m.BusyDialog,this._sDownloadFilterString=null,!com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Maintain,com.zespri.awct.util.Enums.AuthorizationObject.Collaboration,com.zespri.awct.util.Enums.AuthorizationFunctions.ZESP)){var a=this.byId("facetFilterOrderHistory"),b=this.byId("facetFilterListOrderHistoryUser");a.removeList(b)}var c=this.byId("facetFilterListOrderHistoryDeliveryStatus"),d=new sap.ui.model.json.JSONModel({values:[{DeliveryStatusKey:this._DeliveryStatus.BeforeRelease,DeliveryStatusValue:com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_COLUMN_TEXT_DELIVERY_STATUS_BEFORE_RELEASE")},{DeliveryStatusKey:this._DeliveryStatus.DeliveryRelease,DeliveryStatusValue:com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_COLUMN_TEXT_DELIVERY_STATUS_DELIVERY_RELEASE")},{DeliveryStatusKey:this._DeliveryStatus.DeliveryLock,DeliveryStatusValue:com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_COLUMN_TEXT_DELIVERY_STATUS_DELIVERY_LOCK")},{DeliveryStatusKey:this._DeliveryStatus.DeliveryUnlock,DeliveryStatusValue:com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_COLUMN_TEXT_DELIVERY_STATUS_DELIVERY_UNLOCK")},{DeliveryStatusKey:this._DeliveryStatus.ChangesDuringLock,DeliveryStatusValue:com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_COLUMN_TEXT_DELIVERY_STATUS_CHANGES_DURING_LOCK")},{DeliveryStatusKey:this._DeliveryStatus.OnUnlockDIFOTIS,DeliveryStatusValue:com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_COLUMN_TEXT_DELIVERY_STATUS_CHANGED_DURING_UNLOCK")}]});c.setModel(d),c.bindItems({path:"/values",template:c.getBindingInfo("items")?c.getBindingInfo("items").template:c.getItems()[0].clone()});var e=this.byId("facetFilterListOrderHistoryExemptionStatus"),f=new sap.ui.model.json.JSONModel({values:[{ExemptionStatusKey:com.zespri.awct.util.Enums.ExemptionStatus.NONE,ExemptionStatusValue:com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_FILTER_EXEMPTION_STATUS_NONE")},{ExemptionStatusKey:com.zespri.awct.util.Enums.ExemptionStatus.PENDING,ExemptionStatusValue:com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_FILTER_EXEMPTION_STATUS_PENDING")},{ExemptionStatusKey:com.zespri.awct.util.Enums.ExemptionStatus.COMPLETE,ExemptionStatusValue:com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_FILTER_EXEMPTION_STATUS_COMPLETE")}]});e.setModel(f),e.bindItems({path:"/values",template:e.getBindingInfo("items")?e.getBindingInfo("items").template:e.getItems()[0].clone()});var g=this,h=g.byId("trackLinesTable"),i=g.byId("supplierLinesTable");sap.ui.Device.os.ios&&(h.addStyleClass("zAwctTableIOS"),i.addStyleClass("zAwctTableIOS")),this._oTrackLinesRowActionsExtension=new com.zespri.awct.util.TableRowActionsExtension({table:h,actionsContent:this._getTableRowActionsContent()}),this._oSupplierLinesRowActionsExtension=new com.zespri.awct.util.TableRowActionsExtension({table:i,actionsContent:this._getTableRowActionsContent()}),com.zespri.awct.util.CommonHelper.manageFacetFilterState(h,this.byId("facetFilterOrderHistory")),com.zespri.awct.util.CommonHelper.manageFacetFilterState(i,this.byId("facetFilterOrderHistory")),com.zespri.awct.util.CommonHelper.manageNoDataText(h),com.zespri.awct.util.CommonHelper.manageNoDataText(i),h.attachUpdateFinished(function(){if(g._bSubmitBatchCalled||g._aSelectedTrackOrderRowContexts.length<=0)return void(g._bSubmitBatchCalled=!1);for(var a=[],b=h.getItems(),c=0;c<g._aSelectedTrackOrderRowContexts.length;c++)for(var d=0;d<b.length;d++)g._aSelectedTrackOrderRowContexts[c].getProperty("OrderHistoryID")===b[d].getBindingContext().getProperty("OrderHistoryID")&&a.push(g._aSelectedTrackOrderRowContexts[c]);g._aSelectedTrackOrderRowContexts=a}),i.attachUpdateFinished(function(){if(g._bSubmitBatchCalled||g._aSelectedSupplierLinesRowContexts.length<=0)return void(g._bSubmitBatchCalled=!1);for(var a=[],b=i.getItems(),c=0;c<g._aSelectedSupplierLinesRowContexts.length;c++)for(var d=0;d<b.length;d++)g._aSelectedSupplierLinesRowContexts[c].getProperty("OrderHistoryID")===b[d].getBindingContext().getProperty("OrderHistoryID")&&a.push(g._aSelectedSupplierLinesRowContexts[c]);g._aSelectedSupplierLinesRowContexts=a}),this.getRouter().attachRoutePatternMatched(function(a){if("Collaboration/TrackOrders"===a.getParameter("name"))if(this._bUserAuthorized){g._updateFooter();var b=this.byId("facetFilterOrderHistory"),c=g.byId("toolbarFilterString"),d=g.byId("textFilter"),e=a.getParameter("arguments").customData;if(e){var f=e.searchFormFilterString,j=e.searchFormFilterObject;this._sDownloadFilterString=e.downloadFilterString,c.setVisible(!0),d.setText(f),d.setTooltip(f),b.setVisible(!1),g._oFilter=j,this._bindTableWithFilterAndSorter()}else{if(this._sDownloadFilterString=null,b.getVisible())if(h.getBinding("items")||i.getBinding("items")){var k=null;switch(g.byId("orderHistoryIconTabBar").getSelectedKey()){case"TrackLines":k=h;break;case"SupplierLines":k=i}k.getBinding("items").refresh(!0)}else this.byId("facetFilterListOrderHistoryLineNumber").setEnabled(!1),this._bindItemsToSeasonFacetList();else b.fireReset(),g._oFilter=null;c.setVisible(!1),b.setVisible(!0)}}else com.zespri.awct.util.NotificationHelper.showErrorToast(com.zespri.awct.util.I18NHelper.getText("TXT_USER_NOT_AUTHORIZED_MESSAGE_TEXT"))},this)},onBeforeRendering:function(){com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Display,com.zespri.awct.util.Enums.AuthorizationObject.Collaboration,com.zespri.awct.util.Enums.AuthorizationFunctions.ZSUP)||com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Display,com.zespri.awct.util.Enums.AuthorizationObject.Collaboration,com.zespri.awct.util.Enums.AuthorizationFunctions.ZESP)?this._bUserAuthorized=!0:(this.byId("pageOrderHistory")&&this.byId("pageOrderHistory").destroy(),this._bUserAuthorized=!1)},_createOrderHistoryTableRow:function(){var a=null;switch(this.byId("orderHistoryIconTabBar").getSelectedKey()){case"TrackLines":a=new sap.ui.xmlfragment("OrderHistoryTrackLinesTableRow","com.zespri.awct.collab.fragment.OrderHistoryTrackLinesTableRowTemplate",this);break;case"SupplierLines":a=new sap.ui.xmlfragment("OrderHistorySupplierLinesTableRow","com.zespri.awct.collab.fragment.OrderHistorySupplierLinesTableRowTemplate",this)}return a},_bindItemsToSeasonFacetList:function(){var a=sap.ui.getCore().getRootComponent().getApplicationParameters().CurrentSeason,b=this,c=null,d=this.byId("facetFilterListOrderHistorySeason");d.setBusy(!0),com.zespri.awct.util.ModelHelper.getJSONModelForRead("/GenericSearchSet",{urlParameters:{$filter:"Scenario eq 'SEASON'"}},function(e){d.setModel(e),d.bindItems({path:"/results",template:d.getBindingInfo("items")?d.getBindingInfo("items").template:d.getItems()[0].clone()});var f={};f[a]=a,d.getItems().length&&d.setSelectedKeys(f),d.setBusy(!1),b._oFilter=b._getFacetFilterObject();var g=null;switch(b.byId("orderHistoryIconTabBar").getSelectedKey()){case"TrackLines":c=b.byId("trackLinesTable"),g=b._oTrackLinesDefaultFilter;break;case"SupplierLines":c=b.byId("supplierLinesTable"),g=b._oSupplierLinesDefaultFilter}c.bindAggregation("items",{path:"/OrderHistorySet",factory:jQuery.proxy(b._createOrderHistoryTableRow,b),sorter:b._oOrderHistoryDefaultSorter,filters:[new sap.ui.model.Filter([g,b._oFilter],!0)]})},function(a){com.zespri.awct.util.NotificationHelper.handleErrorMessage(a)})},handleNavigateToAnotherTab:function(){this._updateFooter(),this._bindTableWithFilterAndSorter()},handleOrderHistoryActionSheetOpen:function(a){var b=a.getSource();this._oActionSheet||(this._oActionSheet=sap.ui.xmlfragment("trackOrdersActionSheetFragment","com.zespri.awct.collab.fragment.TrackOrdersActionSheet",this),this.getView().addDependent(this._oActionSheet)),this._oActionSheet.isOpen()?this._oActionSheet.close():this._oActionSheet.openBy(b),this._updateFooter()},handleRowActionsPress:function(a){switch(this.byId("orderHistoryIconTabBar").getSelectedKey()){case"TrackLines":this._oTrackLinesRowActionsExtension.showRowActions(a.getSource().getBindingContext());break;case"SupplierLines":this._oSupplierLinesRowActionsExtension.showRowActions(a.getSource().getBindingContext())}},_getTableRowActionsContent:function(){var a=sap.ui.getCore().getRootComponent().getModel("i18n"),b=sap.ui.getCore().getRootComponent().getModel();this._oRowActionsCommentsButton=new sap.m.Button({icon:"sap-icon://comment",tooltip:"{i18n>TXT_GENERIC_COMMENTS}",press:[this.handleCommentsDialogOpen,this]});var c=new sap.ui.commons.layout.HorizontalLayout({content:[this._oRowActionsCommentsButton]});return c.setModel(a,"i18n"),c.setModel(b),c},handleCommentsDialogOpen:function(){var a=null;switch(this.byId("orderHistoryIconTabBar").getSelectedKey()){case"TrackLines":a=this.getView().byId("trackLinesTable").getSelectedItem().getBindingContext(),this._oTrackLinesRowActionsExtension.hideRowActions();break;case"SupplierLines":a=this.getView().byId("supplierLinesTable").getSelectedItem().getBindingContext(),this._oSupplierLinesRowActionsExtension.hideRowActions()}if(a){this._oOrderHistoryCommentsDialog||(this._oOrderHistoryCommentsDialog=new sap.ui.xmlfragment("orderHistoryCommentsFragment","com.zespri.awct.collab.fragment.OrderHistoryCommentsDialog",this),this.getView().addDependent(this._oOrderHistoryCommentsDialog));var b=sap.ui.core.Fragment.byId("orderHistoryCommentsFragment","zespriCommentsText"),c=sap.ui.core.Fragment.byId("orderHistoryCommentsFragment","supplierCommentsText");a.getProperty("ApprovalComment")&&a.getProperty("DeliveryReleaseComment")||a.getProperty("ApprovalComment")?(b.setText(a.getProperty("ApprovalComment")),b.removeStyleClass("zAwctTextGrayItalics")):a.getProperty("DeliveryReleaseComment")?(b.setText(a.getProperty("DeliveryReleaseComment")),b.removeStyleClass("zAwctTextGrayItalics")):(b.setText(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_COMMENTS_DIALOG_NO_COMMENTS_TEXT")),b.addStyleClass("zAwctTextGrayItalics")),a.getProperty("RequestComment")?(c.setText(a.getProperty("RequestComment")),c.removeStyleClass("zAwctTextGrayItalics")):(c.setText(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_COMMENTS_DIALOG_NO_COMMENTS_TEXT")),c.addStyleClass("zAwctTextGrayItalics")),this._oOrderHistoryCommentsDialog.setBindingContext(a),this._oOrderHistoryCommentsDialog.open()}},handleOrderHistoryCommentsOKPress:function(){this._oOrderHistoryCommentsDialog.close()},_applyFilter:function(a){var b=this.byId("orderHistoryIconTabBar"),c="",d="";switch(b.getSelectedKey()){case"TrackLines":c=this.byId("trackLinesTable"),a||(a=this._oTrackLinesDefaultFilter),d=new sap.ui.model.Filter([a,this._oTrackLinesDefaultFilter],!0);break;case"SupplierLines":c=this.byId("supplierLinesTable"),a||(a=this._oSupplierLinesDefaultFilter),d=new sap.ui.model.Filter([a,this._oSupplierLinesDefaultFilter],!0)}c.getBinding("items").filter(d,sap.ui.model.FilterType.Application),this._oFilter=a},_getFacetFilterObject:function(){var a=this.byId("facetFilterOrderHistory"),b=a.getLists().filter(function(a){return a.getActive()&&a.getSelectedItems().length}),c=new sap.ui.model.Filter(b.map(function(a){return new sap.ui.model.Filter(a.getSelectedItems().map(function(b){var c=a.getKey(),d=b.getKey(),e=new sap.ui.model.Filter(c,"EQ",d);return e}),!1)}),!0);return c.aFilters.length||(c=null),c},_applyFacetFilters:function(){var a=this._getFacetFilterObject();this._applyFilter(a)},_applyViewSettingsSorting:function(){this.handleOrderHistorySettingsDialogOKPress()},_bindTableWithFilterAndSorter:function(){var a=null;switch(this.byId("orderHistoryIconTabBar").getSelectedKey()){case"TrackLines":a=this.byId("trackLinesTable");break;case"SupplierLines":a=this.byId("supplierLinesTable")}var b={path:"/OrderHistorySet",factory:jQuery.proxy(this._createOrderHistoryTableRow,this)};if(this.byId("facetFilterOrderHistory").getVisible()&&(this._oFilter=this._getFacetFilterObject()),"SupplierLines"===this.byId("orderHistoryIconTabBar").getSelectedKey()?(b.filters=[this._oSupplierLinesDefaultFilter],this._oFilter&&(b.filters=[new sap.ui.model.Filter([this._oSupplierLinesDefaultFilter,this._oFilter],!0)])):"TrackLines"===this.byId("orderHistoryIconTabBar").getSelectedKey()&&(b.filters=[this._oTrackLinesDefaultFilter],this._oFilter&&(b.filters=[new sap.ui.model.Filter([this._oTrackLinesDefaultFilter,this._oFilter],!0)])),b.sorter=this._oOrderHistoryDefaultSorter,this._mParams&&this._mParams.sortItem){var c=this._mParams.sortItem.getKey(),d=this._mParams.sortDescending;b.sorter=[new sap.ui.model.Sorter(c,d),this._oOrderHistoryDefaultSorter]}a.bindAggregation("items",b)},handleListOpen:function(a){var b=a.getSource().getKey(),c=this,d={};switch(b){case"Season":d.facetListControl=this.byId("facetFilterListOrderHistorySeason"),d.entitySetName="GenericSearchSet",d.filterString="Scenario eq 'SEASON'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"SupplierID":d.facetListControl=this.byId("facetFilterListOrderHistorySupplier"),d.entitySetName="SupplierSet",d.filterString="UserID eq '"+c.getView().getModel("currentUserDetails").getProperty("/UserID")+"'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"ExemptionUserID":d.facetListControl=this.byId("facetFilterListOrderHistoryUser"),d.entitySetName="UserSet",d.selectString="UserID",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"Characteristics/Brand":d.facetListControl=this.byId("facetFilterListOrderHistoryBrand"),d.entitySetName="GenericSearchSet",d.filterString="Scenario eq 'BRAND'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"Characteristics/Variety":d.facetListControl=this.byId("facetFilterListOrderHistoryVariety"),d.entitySetName="GenericSearchSet",d.filterString="Scenario eq 'VARIETY'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"Characteristics/Class":d.facetListControl=this.byId("facetFilterListOrderHistoryClass"),d.entitySetName="GenericSearchSet",d.filterString="Scenario eq 'CLASS'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"Characteristics/GrowingMethod":d.facetListControl=this.byId("facetFilterListOrderHistoryGrowingMethod"),d.entitySetName="GenericSearchSet",d.filterString="Scenario eq 'GROWING_METHOD'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"Characteristics/PalletBase":d.facetListControl=this.byId("facetFilterListOrderHistoryPallet"),d.entitySetName="GenericSearchSet",d.filterString="Scenario eq 'PALLET_BASE'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"Characteristics/Stack":d.facetListControl=this.byId("facetFilterListOrderHistoryStack"),d.entitySetName="GenericSearchSet",d.filterString="Scenario eq 'STACKING_CONFIGURATION'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"Characteristics/PackStyle":d.facetListControl=this.byId("facetFilterListOrderHistoryPackStyle"),d.entitySetName="GenericSearchSet",d.filterString="Scenario eq 'PACK_STYLE'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"Characteristics/Size":d.facetListControl=this.byId("facetFilterListOrderHistorySize"),d.entitySetName="GenericSearchSet",d.filterString="Scenario eq 'SIZE'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"Characteristics/Label":d.facetListControl=this.byId("facetFilterListOrderHistoryLabel"),d.entitySetName="GenericSearchSet",d.filterString="Scenario eq 'LABELLING'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1)}},handleListClose:function(a){if(a.getSource().getId()===this.createId("facetFilterListOrderHistorySeason")){var b=a.getSource(),c=b.getSelectedItems().length;if(!c){var d={},e=sap.ui.getCore().getRootComponent().getApplicationParameters().CurrentSeason;d[e]=e,b.setSelectedKeys(d)}}var f=this.byId("facetFilterListOrderHistoryDeliveryNumber"),g=this.byId("facetFilterListOrderHistoryLineNumber");g.setEnabled(f.getSelectedItems().length?!0:!1);var h=this.byId("facetFilterOrderHistory");h.getFiltersModifiedAfterListOpen()&&this._applyFacetFilters()},handleDependentListOpen:function(a){var b=a.getSource().getKey(),c={},d=this.getView().byId("facetFilterListOrderHistorySeason"),e=this.getView().byId("facetFilterListOrderHistoryShipment"),f=this.getView().byId("facetFilterListOrderHistoryDeliveryNumber");switch(b){case"ShipmentID":var g="",h=Object.getOwnPropertyNames(d.getSelectedKeys());if(h.length){var i=[];jQuery.each(h,function(a,b){i.push("Season eq '"+b+"'")}),g=i.join(" or ")}else{var j=sap.ui.getCore().getRootComponent().getApplicationParameters().CurrentSeason;g="Season eq '"+j+"'"}c.facetListControl=this.byId("facetFilterListOrderHistoryShipment"),c.entitySetName="ShipmentSet",c.filterString=g,c.selectString="ShipmentID",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!0);break;case"DeliveryID":var k="",l=Object.getOwnPropertyNames(e.getSelectedKeys());if(l.length){var m=[];jQuery.each(l,function(a,b){m.push("ShipmentID eq '"+b+"'")}),k=m.join(" or ")}c.facetListControl=this.byId("facetFilterListOrderHistoryDeliveryNumber"),c.entitySetName="DeliveryHeaderSet",c.filterString=k,c.selectString="DeliveryHeaderID",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!0);break;case"ContainerID":var n="",o=[],p=Object.getOwnPropertyNames(e.getSelectedKeys());if(p.length){var q=[];jQuery.each(p,function(a,b){q.push("ShipmentID eq '"+b+"'")}),n=q.join(" or "),o.push(n)}c.facetListControl=this.byId("facetFilterListOrderHistoryContainerID"),c.entitySetName="ContainerSet",c.filterString=n,c.selectString="ContainerID",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!0);break;case"DeliveryLineNumber":c.facetListControl=this.byId("facetFilterListOrderHistoryLineNumber"),c.entitySetName="GetLineNumbersForDelivery",c.urlParameter={DeliveryID:"'"+Object.getOwnPropertyNames(f.getSelectedKeys())+"'"},com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!0)}},handleFilterListSelectionChanged:function(a){var b=a.getSource().getKey(),c=this.getView().byId("facetFilterListOrderHistoryDeliveryNumber"),d=this.getView().byId("facetFilterListOrderHistoryContainerID"),e=this.getView().byId("facetFilterListOrderHistoryLineNumber");switch(b){case"ShipmentID":c.setSelectedKeys(),d.setSelectedKeys(),e.setSelectedKeys();break;case"DeliveryID":d.setSelectedKeys(),e.setSelectedKeys()}},handleFacetFilterReset:function(){for(var a=this.byId("facetFilterOrderHistory"),b=a.getLists(),c=0;c<b.length;c++)b[c].setSelectedKeys();var d=sap.ui.getCore().getRootComponent().getApplicationParameters().CurrentSeason,e=this.byId("facetFilterListOrderHistorySeason"),f={};f[d]=d,e.getItems().length&&e.setSelectedKeys(f),this._oFilter=this._getFacetFilterObject(),this._applyFilter(this._oFilter),this.byId("facetFilterListOrderHistoryLineNumber").setEnabled(!1)},handleOrderHistoryBatchRequestExemptionPress:function(){var a=this,b=this.getView().getModel(),c=[],d=[];switch(this.byId("orderHistoryIconTabBar").getSelectedKey()){case"TrackLines":d=this._aSelectedTrackOrderRowContexts;break;case"SupplierLines":d=this._aSelectedSupplierLinesRowContexts}var e=sap.ui.core.Fragment.byId("batchRequestExemptionFragment","requestExemptionReasonSelect"),f=e.getSelectedKey(),g=sap.ui.core.Fragment.byId("batchRequestExemptionFragment","commentsTextArea").getValue();jQuery.each(d,function(a,d){var e=d.getProperty("OrderHistoryID"),h={};h.OrderHistoryID=e,h.ExemptionRequested=parseFloat(d.getProperty("ChargeQuantity"))+"",h.ReasonCode=f,h.RequestComment=g,h.ChargeTimestamp=com.zespri.awct.util.CommonFormatHelper.formatJSDateToEDMDateTimeString(d.getProperty("ChargeTimestamp"),!0);var i="OrderHistorySet('"+e+"')",j=b.createBatchOperation(i,"PATCH",h);c.push(j)}),b.addBatchChangeOperations(c),this._oBatchRequestExemptionDialog.setBusy(!0),b.setHeaders({BusinessAction:this._BusinessAction.REQUEST}),a._bSubmitBatchCalled=!0,b.submitBatch(function(c,d,e){var f=com.zespri.awct.util.NotificationHelper.handleErrorMessage(e);b.setHeaders(null),a._oBatchRequestExemptionDialog.setBusy(!1),a._oBatchRequestExemptionDialog.close(),f||com.zespri.awct.util.NotificationHelper.showSuccessToast(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_BATCH_REQUEST_EXEMPTION_SUCCESS_TOAST")),a._aSelectedTrackOrderRowContexts=[],a._aSelectedSupplierLinesRowContexts=[]},function(b){com.zespri.awct.util.NotificationHelper.handleErrorMessage(b),a._oBatchRequestExemptionDialog.setBusy(!1),a._oBatchRequestExemptionDialog.close()})},handleOrderHistoryBatchRequestExemptionDialogClose:function(){this._oBatchRequestExemptionDialog.close()},handleOrderHistoryRequestExemptionPress:function(){var a=this,b=this.getView().getModel(),c=[];switch(this.byId("orderHistoryIconTabBar").getSelectedKey()){case"TrackLines":c=this._aSelectedTrackOrderRowContexts;break;case"SupplierLines":c=this._aSelectedSupplierLinesRowContexts}var d=sap.ui.core.Fragment.byId("requestExemptionFragment","chargeQuantityInput"),e=sap.ui.core.Fragment.byId("requestExemptionFragment","exemptionRequestedQuantityInput"),f=parseInt(e.getValue(),10),g=parseInt(d.getBindingContext().getProperty("ChargeQuantity"),10);if(isNaN(f)||Math.round(f)!==parseFloat(f)||f>Math.abs(g)||0>f)e.setValueState(sap.ui.core.ValueState.Error),e.setValueStateText(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_REQUEST_EXEMPTION_DIALOG_REQUEST_EXEMPTION_QUANTITY_ERROR_VALUE_STATE_TEXT_MESSAGE"));else{var h={},i=c[0].getProperty("OrderHistoryID"),j=sap.ui.core.Fragment.byId("requestExemptionFragment","requestExemptionReasonSelect"),k=j.getSelectedKey(),l=sap.ui.core.Fragment.byId("requestExemptionFragment","commentsTextArea").getValue();h.OrderHistoryID=i,h.ExemptionRequested=parseFloat(f)+"",h.ReasonCode=k,h.RequestComment=l,h.ChargeTimestamp=com.zespri.awct.util.CommonFormatHelper.formatJSDateToEDMDateTimeString(c[0].getProperty("ChargeTimestamp"),!0);var m="OrderHistorySet('"+i+"')",n=b.createBatchOperation(m,"PATCH",h);b.addBatchChangeOperations([n]),this._oRequestExemptionDialog.setBusy(!0),b.setHeaders({BusinessAction:this._BusinessAction.REQUEST}),a._bSubmitBatchCalled=!0,b.submitBatch(function(c,d,e){var f=com.zespri.awct.util.NotificationHelper.handleErrorMessage(e);b.setHeaders(null),a._oRequestExemptionDialog.setBusy(!1),a._oRequestExemptionDialog.close(),f||com.zespri.awct.util.NotificationHelper.showSuccessToast(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_REQUEST_EXEMPTION_SUCCESS_TOAST")),a._aSelectedTrackOrderRowContexts=[],a._aSelectedSupplierLinesRowContexts=[]},function(c){com.zespri.awct.util.NotificationHelper.handleErrorMessage(c),b.setHeaders(null),a._oRequestExemptionDialog.setBusy(!1),a._oRequestExemptionDialog.close()})}},handleOrderHistoryRequestExemptionDialogClose:function(){this._oRequestExemptionDialog.close()},handleRequestExemptionDialogOpen:function(){var a=null;switch(this.byId("orderHistoryIconTabBar").getSelectedKey()){case"TrackLines":a=this._aSelectedTrackOrderRowContexts;break;case"SupplierLines":a=this._aSelectedSupplierLinesRowContexts}if(1===a.length){var b=a[0];this._oRequestExemptionDialog||(this._oRequestExemptionDialog=new sap.ui.xmlfragment("requestExemptionFragment","com.zespri.awct.collab.fragment.RequestExemptionDialog",this),this.getView().addDependent(this._oRequestExemptionDialog)),this._oRequestExemptionDialog.setBindingContext(b),this._oRequestExemptionDialog.open();var c=sap.ui.core.Fragment.byId("requestExemptionFragment","exemptionRequestedQuantityInput");c.setValue(parseInt(Math.abs(b.getProperty("ChargeQuantity")),10)),c.setValueState(sap.ui.core.ValueState.None),sap.ui.core.Fragment.byId("requestExemptionFragment","commentsTextArea").setValue("")}else a.length>1?(this._oBatchRequestExemptionDialog||(this._oBatchRequestExemptionDialog=new sap.ui.xmlfragment("batchRequestExemptionFragment","com.zespri.awct.collab.fragment.BatchRequestExemptionDialog",this),this.getView().addDependent(this._oBatchRequestExemptionDialog)),this._oBatchRequestExemptionDialog.open(),sap.ui.core.Fragment.byId("batchRequestExemptionFragment","commentsTextArea").setValue("")):com.zespri.awct.util.NotificationHelper.showErrorToast(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_REQUEST_EXEMPTION_ERROR_MESSAGE"))},handleGrantExemptionDialogOpen:function(){var a=null;switch(this.byId("orderHistoryIconTabBar").getSelectedKey()){case"TrackLines":a=this._aSelectedTrackOrderRowContexts;break;case"SupplierLines":a=this._aSelectedSupplierLinesRowContexts}if(1===a.length){var b=a[0];this._oGrantExemptionDialog||(this._oGrantExemptionDialog=new sap.ui.xmlfragment("grantExemptionFragment","com.zespri.awct.collab.fragment.GrantExemptionDialog",this),this.getView().addDependent(this._oGrantExemptionDialog)),this._oGrantExemptionDialog.setBindingContext(b),sap.ui.core.Fragment.byId("grantExemptionFragment","exemptionAcceptanceQuantityInput").setValueState(sap.ui.core.ValueState.None),sap.ui.core.Fragment.byId("grantExemptionFragment","exemptionAcceptanceQuantityInput").setValue(Math.abs(b.getProperty("ExemptionRequested"))),sap.ui.core.Fragment.byId("grantExemptionFragment","commentsTextArea").setValue(""),this._oGrantExemptionDialog.open()}else a.length>1?(this._oBatchGrantExemptionDialog||(this._oBatchGrantExemptionDialog=new sap.ui.xmlfragment("batchGrantExemptionFragment","com.zespri.awct.collab.fragment.BatchGrantExemptionDialog",this),this.getView().addDependent(this._oBatchGrantExemptionDialog)),sap.ui.core.Fragment.byId("batchGrantExemptionFragment","commentsTextArea").setValue(""),this._oBatchGrantExemptionDialog.open()):com.zespri.awct.util.NotificationHelper.showErrorToast(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_GRANT_EXEMPTION_ERROR_MESSAGE"))},handleOrderHistoryBatchGrantExemptionPress:function(){var a=this,b=this.getView().getModel(),c=[],d=[],e=sap.ui.core.Fragment.byId("batchGrantExemptionFragment","commentsTextArea").getValue();switch(this.byId("orderHistoryIconTabBar").getSelectedKey()){case"TrackLines":d=this._aSelectedTrackOrderRowContexts;break;case"SupplierLines":d=this._aSelectedSupplierLinesRowContexts}jQuery.each(d,function(a,d){var f={},g=d.getProperty("OrderHistoryID");f.OrderHistoryID=g,f.ExemptionAccepted=parseFloat(d.getProperty("ExemptionRequested"))+"",f.ChargeTimestamp=com.zespri.awct.util.CommonFormatHelper.formatJSDateToEDMDateTimeString(d.getProperty("ChargeTimestamp"),!0),f.ApprovalComment=e;var h="OrderHistorySet('"+g+"')",i=b.createBatchOperation(h,"PATCH",f);c.push(i)}),b.addBatchChangeOperations(c),b.setHeaders({BusinessAction:this._BusinessAction.APPROVE}),this._oBatchGrantExemptionDialog.setBusy(!0),a._bSubmitBatchCalled=!0,b.submitBatch(function(c,d,e){var f=com.zespri.awct.util.NotificationHelper.handleErrorMessage(e);b.setHeaders(null),a._oBatchGrantExemptionDialog.setBusy(!1),a._oBatchGrantExemptionDialog.close(),f||com.zespri.awct.util.NotificationHelper.showSuccessToast(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_BATCH_GRANT_EXEMPTION_SUCCESS_TOAST")),a._aSelectedTrackOrderRowContexts=[],a._aSelectedSupplierLinesRowContexts=[]},function(c){a._oBatchGrantExemptionDialog.setBusy(!1),b.setHeaders(null),a._oBatchGrantExemptionDialog.close(),com.zespri.awct.util.NotificationHelper.handleErrorMessage(c)})},handleOrderHistoryBatchGrantExemptionDialogClose:function(){this._oBatchGrantExemptionDialog.close()},handleOrderHistoryGrantExemptionPress:function(){var a=this,b=sap.ui.core.Fragment.byId("grantExemptionFragment","exemptionAcceptanceQuantityInput"),c=sap.ui.core.Fragment.byId("grantExemptionFragment","chargeQuantityInput"),d=sap.ui.core.Fragment.byId("grantExemptionFragment","commentsTextArea").getValue(),e=parseInt(b.getValue(),10),f=parseInt(c.getBindingContext().getProperty("ChargeQuantity"),10);if(isNaN(e)||Math.round(e)!==parseFloat(e)||e>Math.abs(f)||0>=e)b.setValueState(sap.ui.core.ValueState.Error),b.setValueStateText(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_GRANT_EXEMPTION_DIALOG_GRANT_EXEMPTION_ERROR_VALUE_STATE_TEXT_MESSAGE"));else{b.setValueState(sap.ui.core.ValueState.None);var g=this.getView().getModel(),h=[];switch(this.byId("orderHistoryIconTabBar").getSelectedKey()){case"TrackLines":h=this._aSelectedTrackOrderRowContexts;break;case"SupplierLines":h=this._aSelectedSupplierLinesRowContexts}var i={},j=h[0].getProperty("OrderHistoryID");i.OrderHistoryID=j,i.ExemptionAccepted=parseFloat(b.getValue())+"",i.ApprovalComment=d,i.ChargeTimestamp=com.zespri.awct.util.CommonFormatHelper.formatJSDateToEDMDateTimeString(h[0].getProperty("ChargeTimestamp"),!0);var k="OrderHistorySet('"+j+"')",l=g.createBatchOperation(k,"PATCH",i);g.addBatchChangeOperations([l]),this._oGrantExemptionDialog.setBusy(!0),g.setHeaders({BusinessAction:this._BusinessAction.APPROVE}),a._bSubmitBatchCalled=!0,g.submitBatch(function(b,c,d){var e=com.zespri.awct.util.NotificationHelper.handleErrorMessage(d);g.setHeaders(null),a._oGrantExemptionDialog.setBusy(!1),a._oGrantExemptionDialog.close(),e||com.zespri.awct.util.NotificationHelper.showSuccessToast(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_GRANT_EXEMPTION_SUCCESS_TOAST")),a._aSelectedTrackOrderRowContexts=[],a._aSelectedSupplierLinesRowContexts=[]},function(b){com.zespri.awct.util.NotificationHelper.handleErrorMessage(b),g.setHeaders(null),a._oGrantExemptionDialog.setBusy(!1),a._oGrantExemptionDialog.close()})}},handleRejectExemptionDialogOpen:function(){var a=null,b=!0;switch(this.byId("orderHistoryIconTabBar").getSelectedKey()){case"TrackLines":a=this._aSelectedTrackOrderRowContexts;break;case"SupplierLines":a=this._aSelectedSupplierLinesRowContexts
}if(jQuery.each(a,function(a,c){var d=c.getProperty("ExemptionStatus");(d!==com.zespri.awct.util.Enums.ExemptionStatus.PENDING||c.getProperty("ExemptionRequested")<=0)&&(b=!1)}),a.length){if(!b)return void com.zespri.awct.util.NotificationHelper.showErrorToast(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_REJECT_EXEMPTION_CONDITIONS_NOT_SATISFIED_ERROR_MESSAGE"));this._oRejectExemptionDialog||(this._oRejectExemptionDialog=new sap.ui.xmlfragment("rejectExemptionFragment","com.zespri.awct.collab.fragment.OrderHistoryRejectExemptionDialog",this),this.getView().addDependent(this._oRejectExemptionDialog)),sap.ui.core.Fragment.byId("rejectExemptionFragment","commentsTextArea").setValue(""),this._oRejectExemptionDialog.open()}else com.zespri.awct.util.NotificationHelper.showErrorToast(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_REJECT_EXEMPTION_ERROR_MESSAGE"))},handleOrderHistoryRejectExemptionOKPress:function(){var a=this,b=this.getView().getModel(),c=[],d=[],e=sap.ui.core.Fragment.byId("rejectExemptionFragment","commentsTextArea").getValue();switch(this.byId("orderHistoryIconTabBar").getSelectedKey()){case"TrackLines":d=this._aSelectedTrackOrderRowContexts;break;case"SupplierLines":d=this._aSelectedSupplierLinesRowContexts}jQuery.each(d,function(a,d){var f={},g=d.getProperty("OrderHistoryID");f.OrderHistoryID=g,f.ExemptionAccepted="0",f.ChargeTimestamp=com.zespri.awct.util.CommonFormatHelper.formatJSDateToEDMDateTimeString(d.getProperty("ChargeTimestamp"),!0),f.ApprovalComment=e;var h="OrderHistorySet('"+g+"')",i=b.createBatchOperation(h,"PATCH",f);c.push(i)}),b.addBatchChangeOperations(c),b.setHeaders({BusinessAction:this._BusinessAction.APPROVE}),this._oRejectExemptionDialog.setBusy(!0),a._bSubmitBatchCalled=!0,b.submitBatch(function(c,d,e){var f=com.zespri.awct.util.NotificationHelper.handleErrorMessage(e);b.setHeaders(null),a._oRejectExemptionDialog.setBusy(!1),a._oRejectExemptionDialog.close();var g=0;switch(a.byId("orderHistoryIconTabBar").getSelectedKey()){case"TrackLines":g=a._aSelectedTrackOrderRowContexts.length;break;case"SupplierLines":g=a._aSelectedSupplierLinesRowContexts.length}if(!f){var h="";h=com.zespri.awct.util.I18NHelper.getText(1===g?"TXT_COLLABORATION_ORDERHISTORY_SINGLE_ROW_REJECT_EXEMPTION_SUCCESS_TOAST":"TXT_COLLABORATION_ORDERHISTORY_MULTIPLE_ROWS_REJECT_EXEMPTION_SUCCESS_TOAST"),com.zespri.awct.util.NotificationHelper.showSuccessToast(h)}a._aSelectedTrackOrderRowContexts=[],a._aSelectedSupplierLinesRowContexts=[]},function(c){a._oRejectExemptionDialog.setBusy(!1),b.setHeaders(null),a._oRejectExemptionDialog.close(),com.zespri.awct.util.NotificationHelper.handleErrorMessage(c)})},handleOrderHistoryRejectExemptionClosePress:function(){this._oRejectExemptionDialog.close()},handleOrderHistoryGrantExemptionDialogClose:function(){this._oGrantExemptionDialog.close()},handleExportAsCSVButtonPressed:function(){var a="";a=this._sDownloadFilterString?this._sDownloadFilterString:this._createFilterString();var b="";b="TrackLines"===this.byId("orderHistoryIconTabBar").getSelectedKey()?com.zespri.awct.util.Enums.AllocationLineRecordType.DeliveryLine:com.zespri.awct.util.Enums.AllocationLineRecordType.SupplierOrderLine,a=a+" and (RecordType eq '"+b+"')";var c=this.getView().getModel();c.setHeaders({BusinessAction:this._BusinessAction.DOWNLOAD,FileType:this._FileType.CSV}),this._oBusyDialog.open();var d=this;com.zespri.awct.util.ModelHelper.getJSONModelForRead("/OrderHistorySet",{urlParameters:{$filter:a}},function(a){c.setHeaders(null),d._oBusyDialog.close();var b=a.getData().results[0].FileGuid;return 0!==parseInt(b,10)||isNaN(b)?(com.zespri.awct.util.NotificationHelper.showSuccessToast(com.zespri.awct.util.I18NHelper.getText("TXT_REPORTS_GENERATE_FORM_STARTING_DOWNLOAD_TOAST_MESSAGE")),void(window.location.href=window.location.protocol+"//"+window.location.host+"/sap/opu/odata/sap/Z_AWCT_SRV/FileDownloadSet('"+b+"')/$value")):void com.zespri.awct.util.NotificationHelper.showSuccessToast(com.zespri.awct.util.I18NHelper.getText("TXT_GENERIC_DOWNLOAD_NO_MATCHING_RESULTS_FOUND_MESSAGE"))},function(a){com.zespri.awct.util.NotificationHelper.handleErrorMessage(a),c.setHeaders(null),d._oBusyDialog.close()})},formatProductName:function(a,b,c,d,e,f,g,h,i){return a+"-"+b+"-"+c+"-"+d+"-"+e+"-"+f+"-"+g+"-"+h+"-"+i},_findIndexInArray:function(a,b){var c=-1;return jQuery.each(b,function(b,d){d.getProperty("OrderHistoryID")===a&&(c=b)}),c},handleChangeCheckboxSelection:function(a){var b=a.getSource().getBindingContext(),c="",d=0;switch(this.byId("orderHistoryIconTabBar").getSelectedKey()){case"TrackLines":a.getSource().getSelected()?this._aSelectedTrackOrderRowContexts.push(b):(c=b.getProperty("OrderHistoryID"),d=this._findIndexInArray(c,this._aSelectedTrackOrderRowContexts),this._aSelectedTrackOrderRowContexts.splice(d,1));break;case"SupplierLines":a.getSource().getSelected()?this._aSelectedSupplierLinesRowContexts.push(b):(c=b.getProperty("OrderHistoryID"),d=this._findIndexInArray(c,this._aSelectedSupplierLinesRowContexts),this._aSelectedSupplierLinesRowContexts.splice(d,1))}},formatCheckBoxVisible:function(a,b,c){var d=com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Maintain,com.zespri.awct.util.Enums.AuthorizationObject.Collaboration,com.zespri.awct.util.Enums.AuthorizationFunctions.ZSUP),e=com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Maintain,com.zespri.awct.util.Enums.AuthorizationObject.Collaboration,com.zespri.awct.util.Enums.AuthorizationFunctions.ZESP),f=parseFloat(b),g=parseFloat(a);return d&&e&&(d=!1),d&&0!==g&&0!==f&&c===this._AllocationLineRecordType.SupplierOrderLine||e&&0!==g&&0!==f?!0:!1},handleSortTrackOrdersTableButtonPressed:function(){this._oSortOrderHistoryTableDialog||(this._oSortOrderHistoryTableDialog=sap.ui.xmlfragment("com.zespri.awct.collab.fragment.TrackOrdersSettingsDialog",this),this.getView().addDependent(this._oSortOrderHistoryTableDialog)),this._oSortOrderHistoryTableDialog.open()},handleOrderHistorySettingsDialogOKPress:function(a){var b=null;switch(this.byId("orderHistoryIconTabBar").getSelectedKey()){case"TrackLines":b=this.byId("trackLinesTable");break;case"SupplierLines":b=this.byId("supplierLinesTable")}var c=b.getBinding("items"),d=null;a?(d=a.getParameters(),this._mParams=d):d=this._mParams;var e=[];if(d&&d.sortItem){var f=d.sortItem.getKey(),g=d.sortDescending;e.push(new sap.ui.model.Sorter(f,g))}e.push(this._oOrderHistoryDefaultSorter),c.sort(e)},handleToolbarPress:function(){this.getRouter().navBack()},formatIsConsumed:function(a){return com.zespri.awct.util.I18NHelper.getText(a?"TXT_GENERIC_YES":"TXT_COLLABORATION_ORDERHISTORY_COLUMN_TEXT_IS_CONSUMED_NO")},formatDeliveryStatus:function(a){return a===this._DeliveryStatus.BeforeRelease?com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_COLUMN_TEXT_DELIVERY_STATUS_BEFORE_RELEASE"):a===this._DeliveryStatus.DeliveryRelease?com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_COLUMN_TEXT_DELIVERY_STATUS_DELIVERY_RELEASE"):a===this._DeliveryStatus.DeliveryLock?com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_COLUMN_TEXT_DELIVERY_STATUS_DELIVERY_LOCK"):a===this._DeliveryStatus.DeliveryUnlock?com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_COLUMN_TEXT_DELIVERY_STATUS_DELIVERY_UNLOCK"):a===this._DeliveryStatus.ChangesDuringLock?com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_COLUMN_TEXT_DELIVERY_STATUS_CHANGES_DURING_LOCK"):a===this._DeliveryStatus.OnUnlockDIFOTIS?com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_COLUMN_TEXT_DELIVERY_STATUS_CHANGED_DURING_UNLOCK"):""},handleShowReasonCodeDescriptionPopover:function(a){var b=a.getSource(),c=b.getBindingContext();this._oReasonCodeDescriptionPopover||(this._oReasonCodeDescriptionPopover=new sap.m.Popover({placement:sap.m.PlacementType.Vertical,contentWidth:"250px",title:"{ReasonCode}",content:[new sap.m.Text({text:{path:"ReasonCodeDescription",formatter:this._formatReasonCodeDescription}})]}).addStyleClass("zAwctPopoverPadding"),this.getView().addDependent(this._oReasonCodeDescriptionPopover)),this._oReasonCodeDescriptionPopover.setBindingContext(c);var d=this._oReasonCodeDescriptionPopover.getContent()[0];c.getProperty("ReasonCodeDescription")?d.removeStyleClass("zAwctTextGrayItalics"):d.addStyleClass("zAwctTextGrayItalics"),this._oReasonCodeDescriptionPopover.openBy(b)},_formatReasonCodeDescription:function(a){return a?a:com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_ORDERHISTORY_REASON_CODE_DESCRIPTION_NO_TEXT")},_updateFooter:function(){var a=this.byId("orderHistoryIconTabBar").getSelectedKey();com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Display,com.zespri.awct.util.Enums.AuthorizationObject.Collaboration,com.zespri.awct.util.Enums.AuthorizationFunctions.ZSUP)||com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Display,com.zespri.awct.util.Enums.AuthorizationObject.Collaboration,com.zespri.awct.util.Enums.AuthorizationFunctions.ZESP)?(this.byId("orderHistoryActionSheetButton").setVisible(com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Maintain,com.zespri.awct.util.Enums.AuthorizationObject.Collaboration,com.zespri.awct.util.Enums.AuthorizationFunctions.ZESP)?!0:"TrackLines"===a&&com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Maintain,com.zespri.awct.util.Enums.AuthorizationObject.Collaboration,com.zespri.awct.util.Enums.AuthorizationFunctions.ZSUP)?!1:!0),this.byId("orderHistoryExportAsCSVButton").setVisible(!0)):(this.byId("orderHistoryActionSheetButton").setVisible(!1),this.byId("orderHistoryExportAsCSVButton").setVisible(!1),this.byId("pageOrderHistory").getFooter()&&this.byId("pageOrderHistory").getFooter().destroy()),this._oActionSheet&&(sap.ui.core.Fragment.byId("trackOrdersActionSheetFragment","rejectExemptionButton").setVisible(!1),sap.ui.core.Fragment.byId("trackOrdersActionSheetFragment","grantExemptionButton").setVisible(!1),sap.ui.core.Fragment.byId("trackOrdersActionSheetFragment","requestExemptionButton").setVisible(!1),com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Maintain,com.zespri.awct.util.Enums.AuthorizationObject.Collaboration,com.zespri.awct.util.Enums.AuthorizationFunctions.ZESP)?(sap.ui.core.Fragment.byId("trackOrdersActionSheetFragment","grantExemptionButton").setVisible(!0),"TrackLines"!==a&&sap.ui.core.Fragment.byId("trackOrdersActionSheetFragment","rejectExemptionButton").setVisible(!0)):(sap.ui.core.Fragment.byId("trackOrdersActionSheetFragment","grantExemptionButton").setVisible(!1),sap.ui.core.Fragment.byId("trackOrdersActionSheetFragment","rejectExemptionButton").setVisible(!1)),com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Maintain,com.zespri.awct.util.Enums.AuthorizationObject.Collaboration,com.zespri.awct.util.Enums.AuthorizationFunctions.ZSUP)&&!com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Maintain,com.zespri.awct.util.Enums.AuthorizationObject.Collaboration,com.zespri.awct.util.Enums.AuthorizationFunctions.ZESP)&&"TrackLines"!==a&&sap.ui.core.Fragment.byId("trackOrdersActionSheetFragment","requestExemptionButton").setVisible(!0))},_createFilterString:function(){var a=this.byId("facetFilterOrderHistory"),b=a.getLists(),c="",d=!0;return $.each(b,function(a,b){if(b.getSelectedItems().length>0){var e=b.getKey(),f=b instanceof com.zespri.awct.control.FacetFilterDateInputList;$.each(b.getSelectedItems(),function(a,b){var g=b.getKey();if(g=f?"datetime'"+g+"T00:00:00'":"'"+g+"'",c&&!d)if(")"!==c[c.length-1]){var h=c.lastIndexOf("and")+4;-1!==c.lastIndexOf("and")?(c=c.substring(0,h)+"("+c.substring(h,c.length),c=c+" or "+e+" eq "+g+")"):c=c+" or "+e+" eq "+g}else c=c.substring(0,c.length-1),c=c+" or "+e+" eq "+g+")";else c&&d?(c=c+" and "+e+" eq "+g,d=!1):(c=e+" eq "+g,d=!1)}),c&&(d=!0)}}),c},formatQuantityAsAbsoluteInteger:function(a){if(a){var b=parseInt(a,10);return Math.abs(b)}return""}})}();