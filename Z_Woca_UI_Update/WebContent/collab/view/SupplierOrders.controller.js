/*----------------------------------------------------------------------* 
 * Copyright  (c) 2014 SAP SE. All rights reserved	
 * Author       : SAP Custom Development 
 *----------------------------------------------------------------------*/ 
	!function(){"use strict";jQuery.sap.require({modName:"com.zespri.awct.core.Controller",type:"controller"}),jQuery.sap.require("com.zespri.awct.control.FacetFilterDateInputList"),jQuery.sap.require("com.zespri.awct.control.FacetFilterNumberInputList"),jQuery.sap.require("com.zespri.awct.util.CommonFormatHelper"),jQuery.sap.require("com.zespri.awct.util.CommonHelper"),jQuery.sap.require("com.zespri.awct.util.Enums"),jQuery.sap.require("com.zespri.awct.util.I18NHelper"),jQuery.sap.require("com.zespri.awct.util.LocaleFormatHelper"),jQuery.sap.require("com.zespri.awct.util.NotificationHelper"),jQuery.sap.require("com.zespri.awct.util.ModelHelper"),jQuery.sap.require("com.zespri.awct.util.TableRowActionsExtension"),jQuery.sap.require("sap.ui.commons.layout.HorizontalLayout"),jQuery.sap.require("sap.ui.core.format.NumberFormat"),com.zespri.awct.core.Controller.extend("com.zespri.awct.collab.view.SupplierOrders",{_Brand:{ZESPRI:"Z"},_BusinessAction:{DOWNLOAD:"Download"},_FileType:{CSV:"CSV"},onInit:function(){this._bUserAuthorized=!1,this._oDeclareShortageDialog=null,this._oConfirmShortageDialog=null,this._oDeclareSurplusDialog=null,this._oDeclareSurplusDeliveryLineDialog=null,this._oRowActionsExtension=null,this._oSettingsDialog=null,this._oSelectedRowContext=null,this._oViewTextsAndBatchCharacteristicsDialog=null,this._oInitiateTradeDialog=null,this._oRowActionsAllocationSurplusButton=null,this._oRowActionsDeliveryLineSurplusButton=null,this._oRowActionsShortageButton=null,this._oRowActionsInitiateTradeButton=null,this._iUniqueIdCounter=0,this._oBusyDialog=new sap.m.BusyDialog,this._sDownloadFilterString=null;var a=this,b=this.byId("supplierOrdersTable"),c=this.byId("facetFilterCollaboration");com.zespri.awct.util.CommonHelper.manageFacetFilterState(b,c),com.zespri.awct.util.CommonHelper.manageNoDataText(b),this._oRowActionsExtension=new com.zespri.awct.util.TableRowActionsExtension({table:b,actionsContent:this._getTableRowActionsContent()}),sap.ui.Device.os.ios&&b.addStyleClass("zAwctTableIOS"),this._oRowActionsExtension.getActionsContent().addEventDelegate({onAfterRendering:function(b){var c=b.srcControl.getBindingContext().getProperty("StatusCode"),d=com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_SUPPLIERORDERS_COLUMN_ROW_ACTIONS_BUTTON_TOOLTIP_LOCKED");a._oRowActionsDeliveryLineSurplusButton.setVisible(com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Maintain,com.zespri.awct.util.Enums.AuthorizationObject.Collaboration,com.zespri.awct.util.Enums.AuthorizationFunctions.ZSUP)?!0:!1),c===com.zespri.awct.util.Enums.DeliveryStatus.Locked?(a._oRowActionsAllocationSurplusButton.setEnabled(!1),a._oRowActionsDeliveryLineSurplusButton.setEnabled(!1),a._oRowActionsShortageButton.setEnabled(!1),a._oRowActionsInitiateTradeButton.setEnabled(!1),a._oRowActionsAllocationSurplusButton.$().parent().attr("title",d),a._oRowActionsDeliveryLineSurplusButton.$().parent().attr("title",d),a._oRowActionsShortageButton.$().parent().attr("title",d),a._oRowActionsInitiateTradeButton.$().parent().attr("title",d),a._oRowActionsAllocationSurplusButton.setTooltip(d),a._oRowActionsDeliveryLineSurplusButton.setTooltip(d),a._oRowActionsShortageButton.setTooltip(d),a._oRowActionsInitiateTradeButton.setTooltip(d),a._oRowActionsAllocationSurplusButton.rerender(),a._oRowActionsDeliveryLineSurplusButton.rerender(),a._oRowActionsShortageButton.rerender(),a._oRowActionsInitiateTradeButton.rerender()):(a._oRowActionsAllocationSurplusButton.setEnabled(!0),a._oRowActionsDeliveryLineSurplusButton.setEnabled(!0),a._oRowActionsShortageButton.setEnabled(!0),a._oRowActionsInitiateTradeButton.setEnabled(!0),a._oRowActionsAllocationSurplusButton.$().parent().attr("title",""),a._oRowActionsDeliveryLineSurplusButton.$().parent().attr("title",""),a._oRowActionsShortageButton.$().parent().attr("title",""),a._oRowActionsInitiateTradeButton.$().parent().attr("title",""),a._oRowActionsAllocationSurplusButton.setTooltip(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_SUPPLIERORDERS_DECLARE_SURPLUS_BUTTON")),a._oRowActionsDeliveryLineSurplusButton.setTooltip(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_SUPPLIERORDERS_DECLARE_SURPLUS_BUTTON")),a._oRowActionsShortageButton.setTooltip(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_SUPPLIERORDERS_DECLARE_SHORTAGE_BUTTON")),a._oRowActionsInitiateTradeButton.setTooltip(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_SUPPLIERORDERS_INITIATE_TRADE_BUTTON")),a._oRowActionsAllocationSurplusButton.rerender(),a._oRowActionsDeliveryLineSurplusButton.rerender(),a._oRowActionsShortageButton.rerender(),a._oRowActionsInitiateTradeButton.rerender())}}),this.getRouter().attachRoutePatternMatched(function(c){if("Collaboration/SupplierOrders"===c.getParameter("name"))if(this._bUserAuthorized){var d=a.byId("toolbarFilterString"),e=a.byId("textFilter"),f=a.byId("facetFilterCollaboration"),g=c.getParameter("arguments").customData;if(g){var h=null;if(g.filters)d.setVisible(!1),f.setVisible(!0),a._clearFacetFilterSelections(),a._initializeDashboardFilters(g.filters);else{var i=g.searchFormFilterString;if(h=g.searchFormFilterObject,this._sDownloadFilterString=g.downloadFilterString,d.setVisible(!0),e.setText(i),e.setTooltip(i),f.setVisible(!1),b.getBinding("items"))b.getBinding("items").filter(h,sap.ui.model.FilterType.Application);else{var j={path:"/CollaborationLineSet",factory:jQuery.proxy(a._createSupplierOrderTableRow,a),sorter:[new sap.ui.model.Sorter({path:"DeliveryLineNumber",descending:!1,group:!1}),new sap.ui.model.Sorter({path:"SupplierID",descending:!1,group:!1})]};h&&(j.filters=[h]),b.bindAggregation("items",j)}}}else this._sDownloadFilterString=null,f.getVisible()?b.getBinding("items")?b.getBinding("items").refresh(!0):b.bindAggregation("items",{path:"/CollaborationLineSet",factory:jQuery.proxy(a._createSupplierOrderTableRow,a),sorter:[new sap.ui.model.Sorter({path:"DeliveryLineNumber",descending:!1,group:!1}),new sap.ui.model.Sorter({path:"SupplierID",descending:!1,group:!1})]}):f.fireReset(),d.setVisible(!1),f.setVisible(!0)}else com.zespri.awct.util.NotificationHelper.showErrorToast(com.zespri.awct.util.I18NHelper.getText("TXT_USER_NOT_AUTHORIZED_MESSAGE_TEXT"))},this)},onBeforeRendering:function(){com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Display,com.zespri.awct.util.Enums.AuthorizationObject.Collaboration,com.zespri.awct.util.Enums.AuthorizationFunctions.ZSUP)||com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Display,com.zespri.awct.util.Enums.AuthorizationObject.Collaboration,com.zespri.awct.util.Enums.AuthorizationFunctions.ZESP)?this._bUserAuthorized=!0:(this.byId("pageSupplierOrders")&&this.byId("pageSupplierOrders").destroy(),this._bUserAuthorized=!1)},_clearFacetFilterSelections:function(){for(var a=this.byId("facetFilterCollaboration"),b=a.getLists(),c=0;c<b.length;c++)b[c].setSelectedKeys()},_initializeDashboardFilters:function(a){var b=this,c,d;if(a.Shortage>=0){var e={};e.value=a.Shortage,b.byId("facetFilterListShortagesGreaterThan").setSelectedKeys([e])}if(a.Surplus>=0){var f={};f.value=a.Surplus,b.byId("facetFilterListSurplusesGreaterThan").setSelectedKeys([f])}if(a.CharterOrContainer){var g={};g[a.CharterOrContainer]=a.CharterOrContainer,b.byId("facetFilterListCharterOrContainer").setSelectedKeys(g)}if(a.RecordType){var h=this.byId("facetFilterListShowDemandLines"),i;switch(a.RecordType){case com.zespri.awct.util.Enums.AllocationLineRecordType.SupplierOrderLine:i=!1;break;default:i=!0}h.setSelectedKeys([{value:i}])}if(c=$.Deferred(),d=c.promise(),a.ShipmentID){if(a.ShipmentID.length<=0)return;for(var j={},k=0;k<a.ShipmentID.length;k++)j[a.ShipmentID[k]]=a.ShipmentID[k];var l=sap.ui.getCore().getRootComponent().getApplicationParameters().CurrentSeason,m=b.byId("facetFilterListShipmentNo");m.getBinding("items")?(m.setSelectedKeys(j),m.setBusy(!1),c.resolve()):(m.setBusy(!0),com.zespri.awct.util.ModelHelper.getJSONModelForRead("/ShipmentSet",{urlParameters:{$select:"ShipmentID",$filter:"Season eq '"+l+"'"}},function(a){m.setModel(a),m.bindItems({path:"/results",template:m.getBindingInfo("items")?m.getBindingInfo("items").template:m.getItems()[0].clone()}),m.setSelectedKeys(j),m.setBusy(!1),c.resolve()},function(a){com.zespri.awct.util.NotificationHelper.handleErrorMessage(a),c.resolve()}))}else c.resolve();$.when(d).done(function(){b._applyFacetFilters()})},_getFacetFilterObject:function(){var a=this.byId("facetFilterCollaboration"),b=a.getLists().filter(function(a){return a.getActive()&&a.getSelectedItems().length&&"ShowDemandLines"!==a.getKey()||"ShowDemandLines"===a.getKey()&&!a.getSelectedItems()[0].getKey()}),c=new sap.ui.model.Filter(b.map(function(a){return new sap.ui.model.Filter(a.getSelectedItems().map(function(b){var c=a.getKey(),d=b.getKey(),e=null;switch(c){case"Shortage":e=new sap.ui.model.Filter(c,"GT",d);break;case"Surplus":e=new sap.ui.model.Filter(c,"GT",d);break;case"ShowDemandLines":b.getKey()||(c="RecordType",e=new sap.ui.model.Filter(c,"EQ","A"));break;default:e=new sap.ui.model.Filter(c,"EQ",d)}return e}),!1)}),!0);return c},_applyFacetFilters:function(){var a=this._getFacetFilterObject(),b=this,c=this.byId("supplierOrdersTable");if(c.getBinding("items"))c.getBinding("items").filter(a,sap.ui.model.FilterType.Application);else{var d={path:"/CollaborationLineSet",factory:jQuery.proxy(b._createSupplierOrderTableRow,b),sorter:[new sap.ui.model.Sorter({path:"DeliveryLineNumber",descending:!1,group:!1}),new sap.ui.model.Sorter({path:"SupplierID",descending:!1,group:!1})]};a&&(d.filters=[a]),c.bindAggregation("items",d)}},_createSupplierOrderTableRow:function(a,b){var c="supplierOrdersTableRow"+this._iUniqueIdCounter++,d=new sap.ui.xmlfragment(c,"com.zespri.awct.collab.fragment.SupplierOrdersTableRow",this);return sap.ui.core.Fragment.byId(c,"actionsButton").setVisible(com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Maintain,com.zespri.awct.util.Enums.AuthorizationObject.Collaboration,com.zespri.awct.util.Enums.AuthorizationFunctions.ZSUP)||b.getProperty("RecordType")===com.zespri.awct.util.Enums.AllocationLineRecordType.DeliveryLine?!0:!1),b.getProperty("Characteristic/Brand")!==this._Brand.ZESPRI?d.addStyleClass("zAwctColumnListItemNonZespriBrand"):b.getProperty("RecordType")===com.zespri.awct.util.Enums.AllocationLineRecordType.DeliveryLine&&b.getProperty("Characteristic/Brand")===this._Brand.ZESPRI&&d.addStyleClass("zAwctColumnListItemDemandLineZespriBrand"),this.getView().addDependent(d),d.setBindingContext(b),d},formatQuantityCellVisibility:function(a){var b=parseInt(a,10);return b?!0:!1},formatAllocationLineRowActionVisibility:function(a){return a?a===com.zespri.awct.util.Enums.AllocationLineRecordType.SupplierOrderLine?!0:!1:void 0},formatDeliveryLineRowActionVisibility:function(a){return a?a===com.zespri.awct.util.Enums.AllocationLineRecordType.DeliveryLine?!0:!1:void 0},formatDeliveryInstructionNumber:function(a){return parseInt(a,10)||isNaN(a)?a:""},_getTableRowActionsContent:function(){var a=sap.ui.getCore().getRootComponent().getModel("i18n"),b=sap.ui.getCore().getRootComponent().getModel();this._oRowActionsShortageButton=new sap.m.Button({icon:"sap-icon://sys-minus",press:[this.handleDeclareShortageOpen,this],visible:{path:"RecordType",formatter:this.formatAllocationLineRowActionVisibility}}),this._oRowActionsAllocationSurplusButton=new sap.m.Button({icon:"sap-icon://sys-add",press:[this.handleDeclareSurplusDialogOpen,this],visible:{path:"RecordType",formatter:this.formatAllocationLineRowActionVisibility}}),this._oRowActionsDeliveryLineSurplusButton=new sap.m.Button({icon:"sap-icon://sys-add",press:[this.handleDeclareSurplusDeliveryLineDialogOpen,this],visible:{path:"RecordType",formatter:this.formatDeliveryLineRowActionVisibility}}),this._oRowActionsInitiateTradeButton=new sap.m.Button({icon:"sap-icon://arrow-right",press:[this.handleInitiateTradeDialogOpen,this],visible:{path:"RecordType",formatter:this.formatAllocationLineRowActionVisibility}});var c=new sap.ui.commons.layout.HorizontalLayout({content:[this._oRowActionsShortageButton,this._oRowActionsAllocationSurplusButton,this._oRowActionsDeliveryLineSurplusButton,new sap.m.Button({icon:"sap-icon://table-view",tooltip:"{i18n>TXT_COLLABORATION_SUPPLIERORDERS_VIEW_TEXT_AND_BATCH_CHARACTERISTICS_BUTTON}",press:[this.handleViewTextsAndBatchCharacteristicsOpen,this],visible:{path:"RecordType",formatter:this.formatDeliveryLineRowActionVisibility}}),this._oRowActionsInitiateTradeButton]});return c.setModel(a,"i18n"),c.setModel(b),c},handleRowActionsPress:function(a){this._oRowActionsExtension.showRowActions(a.getSource().getBindingContext())},handleListOpen:function(a){var b=a.getSource().getKey(),c=this,d={},e=sap.ui.getCore().getRootComponent().getApplicationParameters().CurrentSeason;switch(b){case"SupplierID":d.facetListControl=this.byId("facetFilterListSupplier"),d.entitySetName="SupplierSet",d.filterString="UserID eq '"+c.getView().getModel("currentUserDetails").getProperty("/UserID")+"'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"ShipmentID":d.facetListControl=this.byId("facetFilterListShipmentNo"),d.entitySetName="ShipmentSet",d.filterString="Season eq '"+e+"'",d.selectString="ShipmentID",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"LoadPort":d.facetListControl=this.byId("facetFilterListLoadPort"),d.entitySetName="PortSet",d.filterString="PortType eq 'L'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"ShipmentName":d.facetListControl=this.byId("facetFilterListShipName"),d.entitySetName="GetShipmentNamesForSeason",d.urlParameter={Season:"'"+sap.ui.getCore().getRootComponent().getApplicationParameters().CurrentSeason+"'"},com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"ShipmentType":d.facetListControl=this.byId("facetFilterListShipmentType"),d.entitySetName="GetShipmentTypesForSeason",d.urlParameter={Season:"'"+sap.ui.getCore().getRootComponent().getApplicationParameters().CurrentSeason+"'"},com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"MarketAccessArea":d.facetListControl=this.byId("facetFilterListMarketAccessArea"),d.entitySetName="GenericSearchSet",d.filterString="Scenario eq 'MARKET_ACCESS'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"Marketer":d.facetListControl=this.byId("facetFilterListMarketer"),d.entitySetName="GenericSearchSet",d.filterString="Scenario eq 'MARKETER'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"Characteristic/Brand":d.facetListControl=this.byId("facetFilterListBrand"),d.entitySetName="GenericSearchSet",d.filterString="Scenario eq 'BRAND'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"Characteristic/Variety":d.facetListControl=this.byId("facetFilterListVariety"),d.entitySetName="GenericSearchSet",d.filterString="Scenario eq 'VARIETY'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"Characteristic/Class":d.facetListControl=this.byId("facetFilterListClass"),d.entitySetName="GenericSearchSet",d.filterString="Scenario eq 'CLASS'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"Characteristic/GrowingMethod":d.facetListControl=this.byId("facetFilterListGrowingMethod"),d.entitySetName="GenericSearchSet",d.filterString="Scenario eq 'GROWING_METHOD'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"Characteristic/Stack":d.facetListControl=this.byId("facetFilterListStack"),d.entitySetName="GenericSearchSet",d.filterString="Scenario eq 'STACKING_CONFIGURATION'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"Characteristic/PackStyle":d.facetListControl=this.byId("facetFilterListPackStyle"),d.entitySetName="GenericSearchSet",d.filterString="Scenario eq 'PACK_STYLE'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"Characteristic/Size":d.facetListControl=this.byId("facetFilterListSize"),d.entitySetName="GenericSearchSet",d.filterString="Scenario eq 'SIZE'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1);break;case"Characteristic/Label":d.facetListControl=this.byId("facetFilterListLabel"),d.entitySetName="GenericSearchSet",d.filterString="Scenario eq 'LABELLING'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(d,!1)}},handleFacetFilterReset:function(){this._clearFacetFilterSelections(),this.byId("supplierOrdersTable").getBinding("items").filter(null,sap.ui.model.FilterType.Application)},handleListClose:function(){var a=this.byId("facetFilterCollaboration");if(a.getFiltersModifiedAfterListOpen()){var b=this._getFacetFilterObject();this.byId("supplierOrdersTable").getBinding("items").filter(b,sap.ui.model.FilterType.Application)}},handleDependentListOpen:function(a){var b={},c=a.getSource().getKey(),d="",e=this.getView().byId("facetFilterListShipmentNo"),f=this.getView().byId("facetFilterListDestinationPort"),g=this.getView().byId("facetFilterListDeliveryNo"),h=this.getView().byId("facetFilterListContainerID"),i=Object.getOwnPropertyNames(e.getSelectedKeys())[0],j=Object.getOwnPropertyNames(f.getSelectedKeys()),k=Object.getOwnPropertyNames(g.getSelectedKeys())[0];switch(jQuery.each(e.getSelectedKeys(),function(a){d=d?d+" or ShipmentID eq '"+a+"'":"ShipmentID eq '"+a+"'"}),d&&(d="("+d+")"),c){case"DestinationPort":var l="PortType eq 'D'";f.clearSearchField(),i&&(l+=" and "+d),b.facetListControl=this.byId("facetFilterListDestinationPort"),b.entitySetName="PortSet",b.filterString=l,com.zespri.awct.util.CommonHelper.createFacetFilterListItems(b,!0);break;case"DeliveryID":var m="";g.clearSearchField(),i&&(m=d),b.facetListControl=this.byId("facetFilterListDeliveryNo"),b.entitySetName="DeliveryHeaderSet",b.filterString=m,b.selectString="DeliveryHeaderID",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(b,!0);break;case"ContainerID":var n="";h.clearSearchField();var o=j.length;if(o>0){for(var p=0;o>p;p++)n+="PortID eq '"+j[p]+"' or ";n=n.substring(0,n.length-4)}var q="";i&&(q+=d),q&&n&&(q+=" and "),n&&(q+=n),q&&k&&(q+=" and "),k&&(q+="DeliveryID eq '"+k+"'"),b.facetListControl=this.byId("facetFilterListContainerID"),b.entitySetName="ContainerSet",b.filterString=q,com.zespri.awct.util.CommonHelper.createFacetFilterListItems(b,!0)}},handleFilterListSelectionChanged:function(a){var b=a.getSource().getKey(),c=this.getView().byId("facetFilterListDestinationPort"),d=this.getView().byId("facetFilterListDeliveryNo"),e=this.getView().byId("facetFilterListContainerID");switch(b){case"ShipmentID":c.setSelectedKeys(),d.setSelectedKeys(),e.setSelectedKeys();break;case"DestinationPort":e.setSelectedKeys();break;case"DeliveryID":e.setSelectedKeys()}},handleDeclareShortageOpen:function(){if(this._oRowActionsExtension.hideRowActions(),this._oSelectedRowContext=this.getView().byId("supplierOrdersTable").getSelectedItem().getBindingContext(),this._oSelectedRowContext){this._oDeclareShortageDialog||(this._oDeclareShortageDialog=new sap.ui.xmlfragment("declareShortageFragment","com.zespri.awct.collab.fragment.DeclareShortageDialog",this),this.getView().addDependent(this._oDeclareShortageDialog));var a=sap.ui.core.Fragment.byId("declareShortageFragment","shortageQuantityInput");a.setValueState(sap.ui.core.ValueState.None),this._oDeclareShortageDialog.setBindingContext(this._oSelectedRowContext),a.getBinding("value").refresh(!0),this._oDeclareShortageDialog.open()}},handleDeclareShortageClose:function(){this._oDeclareShortageDialog.close()},handleConfirmShortageOpen:function(){var a=sap.ui.core.Fragment.byId("declareShortageFragment","shortageQuantityInput");a.setValueState(sap.ui.core.ValueState.None);var b=a.getValue();if(this.iShortageQuantityValue=parseInt(b,10),isNaN(b)||Math.round(b)!==parseFloat(b)||this.iShortageQuantityValue>parseInt(this._oSelectedRowContext.getProperty("Quantity"),10)||this.iShortageQuantityValue<=0)a.setValueState(sap.ui.core.ValueState.Error),a.setValueStateText(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_SUPPLIERORDERS_SHORTAGE_ERROR_VALUE_STATE_TEXT"));else{this._oConfirmShortageDialog||(this._oConfirmShortageDialog=new sap.ui.xmlfragment("confirmShortageFragment","com.zespri.awct.collab.fragment.ConfirmShortageDialog",this),this.getView().addDependent(this._oConfirmShortageDialog)),sap.ui.core.Fragment.byId("confirmShortageFragment","commentsTextArea").setValue(""),sap.ui.core.Fragment.byId("confirmShortageFragment","requestExemptionCheckBox").setSelected(!1),sap.ui.core.Fragment.byId("confirmShortageFragment","requestExemptionForm").setVisible(!1);var c=this._oConfirmShortageDialog,d=this._oDeclareShortageDialog;d.setBusy(!0),this.getView().getModel().read("/SetShortage",{urlParameters:{ShortageQuantity:this.iShortageQuantityValue,CalculateFlag:!0,AcceptPenaltyFlag:!1,RequestExemptionFlag:!1,ExemptionComment:"''",ExemptionReason:"''",DeliveryLineID:"'"+this._oSelectedRowContext.getProperty("DeliveryLineID")+"'",AllocationID:"'"+this._oSelectedRowContext.getProperty("AllocationID")+"'",AllocationUpdateTime:com.zespri.awct.util.CommonFormatHelper.formatJSDateToEDMDateTimeString(this._oSelectedRowContext.getProperty("AllocationUpdateTime")),DeliveryLineUpdateTime:com.zespri.awct.util.CommonFormatHelper.formatJSDateToEDMDateTimeString(this._oSelectedRowContext.getProperty("DeliveryLineUpdateTime"))},success:function(b){sap.ui.core.Fragment.byId("confirmShortageFragment","exemptionReasonSelect").setSelectedKey(),c.open();var e=b.SetShortage;sap.ui.core.Fragment.byId("confirmShortageFragment","warningMessageBox").setVisible(e.IsSurplusDeclared?!0:!1),sap.ui.core.Fragment.byId("confirmShortageFragment","surplusShipmentsText").setText(e.SurplusShipmentIDs);var f="",g=com.zespri.awct.util.LocaleFormatHelper.formatAmount(e.Amount,e.Currency),h=com.zespri.awct.util.LocaleFormatHelper.formatAmount(e.Rate,e.Currency),i=com.zespri.awct.util.LocaleFormatHelper.formatQuantity(e.Quantity),j=com.zespri.awct.util.LocaleFormatHelper.formatQuantity(e.DaysFromLoading);f=1===e.DaysFromLoading?com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_SUPPLIERORDERS_ONE_DAYFROMLOADING_PENALTY_MESSAGE",[g,j,h,i]):com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_SUPPLIERORDERS_PENALTY_MESSAGE",[g,j,h,i]),sap.ui.core.Fragment.byId("confirmShortageFragment","showPenaltyText").setText(f),sap.ui.core.Fragment.byId("confirmShortageFragment","exemptionQuantityInput").setValue(parseInt(a.getValue(),10)).setValueState(sap.ui.core.ValueState.None),d.setBusy(!1),d.close()},error:function(a){d.setBusy(!1),com.zespri.awct.util.NotificationHelper.handleErrorMessage(a)}})}},handleConfirmShortageClose:function(){this._oConfirmShortageDialog.close()},handleAcceptPenaltyPress:function(){var a=this.byId("supplierOrdersTable");if(sap.ui.core.Fragment.byId("confirmShortageFragment","requestExemptionCheckBox").getSelected()){var b=sap.ui.core.Fragment.byId("confirmShortageFragment","exemptionQuantityInput"),c=b.getValue(),d=sap.ui.core.Fragment.byId("confirmShortageFragment","exemptionReasonSelect").getSelectedKey(),e=sap.ui.core.Fragment.byId("confirmShortageFragment","commentsTextArea").getValue();if(isNaN(c)||Math.round(c)!==parseFloat(c)||parseInt(c,10)>parseInt(this.iShortageQuantityValue,10)||parseInt(c,10)<=0)b.setValueState(sap.ui.core.ValueState.Error),b.setValueStateText(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_SUPPLIERORDERS_EXEMPT_SHORTAGE_ERROR_VALUE_STATE_TEXT"));else{b.setValueState(sap.ui.core.ValueState.None);var f=this.byId("supplierOrdersTable").getSelectedItem().getBindingContext(),g=this._oConfirmShortageDialog;g.setBusy(!0);var h=this.getView();this.getView().getModel().read("/SetShortage",{urlParameters:{ShortageQuantity:sap.ui.core.Fragment.byId("declareShortageFragment","shortageQuantityInput").getValue(),CalculateFlag:!0,AcceptPenaltyFlag:!0,RequestExemptionFlag:!0,ExemptionComment:"'"+e+"'",ExemptionReason:"'"+d+"'",DeliveryLineID:"'"+f.getProperty("DeliveryLineID")+"'",AllocationID:"'"+f.getProperty("AllocationID")+"'",AllocationUpdateTime:com.zespri.awct.util.CommonFormatHelper.formatJSDateToEDMDateTimeString(f.getProperty("AllocationUpdateTime")),DeliveryLineUpdateTime:com.zespri.awct.util.CommonFormatHelper.formatJSDateToEDMDateTimeString(f.getProperty("DeliveryLineUpdateTime"))},success:function(b){h.getModel().read("/RequestExemption",{urlParameters:{DeliveryLineID:"'"+f.getProperty("DeliveryLineID")+"'",AllocationID:"'"+f.getProperty("AllocationID")+"'",ExemptionQuantity:c,ExemptionReason:"'"+d+"'",Comment:"'"+e+"'",ChargeID:"'"+b.SetShortage.ChargeID+"'"},success:function(){g.setBusy(!1),g.close();var b=com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_SUPPLIERORDERS_TOAST_EXEMPT_PENALTY");com.zespri.awct.util.NotificationHelper.showSuccessToast(b),a.getBinding("items").refresh()},error:function(a){g.setBusy(!1),com.zespri.awct.util.NotificationHelper.handleErrorMessage(a)}})},error:function(a){g.setBusy(!1),com.zespri.awct.util.NotificationHelper.handleErrorMessage(a)}})}}else{var i=this._oConfirmShortageDialog;i.setBusy(!0);var j=this;this.getView().getModel().read("/SetShortage",{urlParameters:{ShortageQuantity:parseInt(sap.ui.core.Fragment.byId("declareShortageFragment","shortageQuantityInput").getValue(),10),CalculateFlag:!0,AcceptPenaltyFlag:!0,RequestExemptionFlag:!1,ExemptionComment:"''",ExemptionReason:"''",DeliveryLineID:"'"+this._oSelectedRowContext.getProperty("DeliveryLineID")+"'",AllocationID:"'"+this._oSelectedRowContext.getProperty("AllocationID")+"'",AllocationUpdateTime:com.zespri.awct.util.CommonFormatHelper.formatJSDateToEDMDateTimeString(this._oSelectedRowContext.getProperty("AllocationUpdateTime")),DeliveryLineUpdateTime:com.zespri.awct.util.CommonFormatHelper.formatJSDateToEDMDateTimeString(this._oSelectedRowContext.getProperty("DeliveryLineUpdateTime"))},success:function(){i.setBusy(!1),j._oConfirmShortageDialog.close();var b=com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_SUPPLIERORDERS_TOAST_PENALTY_ACCEPTED");com.zespri.awct.util.NotificationHelper.showSuccessToast(b),a.getBinding("items").refresh()},error:function(a){i.setBusy(!1),com.zespri.awct.util.NotificationHelper.handleErrorMessage(a)}})}},handleRequestExemptionChecked:function(){var a=sap.ui.core.Fragment.byId("confirmShortageFragment","requestExemptionForm"),b=sap.ui.core.Fragment.byId("confirmShortageFragment","requestExemptionCheckBox");b.getSelected()?a.setVisible(!0):b.getSelected()||a.setVisible(!1),this._oConfirmShortageDialog.rerender()},handleDeclareSurplusDialogOpen:function(){this._oRowActionsExtension.hideRowActions();var a=this.getView().byId("supplierOrdersTable").getSelectedItem().getBindingContext();if(a){this._oDeclareSurplusDialog||(this._oDeclareSurplusDialog=new sap.ui.xmlfragment("declareSurplusFragment","com.zespri.awct.collab.fragment.DeclareSurplusDialog",this),this.getView().addDependent(this._oDeclareSurplusDialog));var b=sap.ui.core.Fragment.byId("declareSurplusFragment","surplusQuantityInput");b.setValueState(sap.ui.core.ValueState.None),this._oDeclareSurplusDialog.setBindingContext(a),b.getBinding("value").refresh(!0),this._oDeclareSurplusDialog.open()}},handleDeclareSurplusQuantityPress:function(){var a=sap.ui.core.Fragment.byId("declareSurplusFragment","surplusQuantityInput"),b=a.getValue(),c=parseInt(b,10);if(isNaN(b)||Math.round(b)!==parseFloat(b)||0>c)a.setValueState(sap.ui.core.ValueState.Error),a.setValueStateText(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_SUPPLIERORDERS_SURPLUS_QUANTITY_ERROR_VALUE_STATE_TEXT"));else{var d=this._oDeclareSurplusDialog;a.setValueState(sap.ui.core.ValueState.None),d.setBusy(!0);var e=this.byId("supplierOrdersTable"),f=this.byId("supplierOrdersTable").getSelectedItem().getBindingContext().getProperty("UOM");this.getView().getModel().read("/SetSurplus",{urlParameters:{DeliveryLineID:"'"+this.byId("supplierOrdersTable").getSelectedItem().getBindingContext().getProperty("DeliveryLineID")+"'",AllocationID:"'"+this.byId("supplierOrdersTable").getSelectedItem().getBindingContext().getProperty("AllocationID")+"'",SurplusQuantity:c,AllocationUpdateTime:com.zespri.awct.util.CommonFormatHelper.formatJSDateToEDMDateTimeString(this.byId("supplierOrdersTable").getSelectedItem().getBindingContext().getProperty("AllocationUpdateTime")),DeliveryLineUpdateTime:com.zespri.awct.util.CommonFormatHelper.formatJSDateToEDMDateTimeString(this.byId("supplierOrdersTable").getSelectedItem().getBindingContext().getProperty("DeliveryLineUpdateTime"))},success:function(){d.setBusy(!1),d.close();var a=com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_SUPPLIERORDERS_TOAST_SURPLUS_POSTED",[c,f]);com.zespri.awct.util.NotificationHelper.showSuccessToast(a),e.getBinding("items").refresh()},error:function(a){d.setBusy(!1),com.zespri.awct.util.NotificationHelper.handleErrorMessage(a)}})}},handleDeclareSurplusDialogClose:function(){this._oDeclareSurplusDialog.close()},formatSupplierID:function(a,b){return b===com.zespri.awct.util.Enums.AllocationLineRecordType.DeliveryLine?com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_SUPPLIERORDERS_COLUMN_SUPPLIER_ID_ALL"):a},formatActionsVisible:function(a){return a===com.zespri.awct.util.Enums.AllocationLineRecordType.DeliveryLine?!1:!0},formatIsConsumed:function(a){return com.zespri.awct.util.I18NHelper.getText(a?"TXT_GENERIC_YES":"TXT_COLLABORATION_SUPPLIERORDERS_COLUMN_TEXT_IS_CONSUMED_NO")},formatActionSheetVisible:function(a,b){return a||b?!0:!1},handleViewSettingsDialogButtonPressed:function(){this._oSettingsDialog||(this._oSettingsDialog=sap.ui.xmlfragment("com.zespri.awct.collab.fragment.SupplierOrdersSettingsDialog",this),this.getView().addDependent(this._oSettingsDialog)),this._oSettingsDialog.open()},handleViewSettingsDialogClose:function(a){var b=this.getView().byId("supplierOrdersTable"),c=b.getBinding("items"),d=a.getParameters(),e=[];if(d.groupItem){var f=d.groupItem.getKey(),g=d.groupDescending;e.push(new sap.ui.model.Sorter(f,g,!0))}if(d.sortItem){var h=d.sortItem.getKey(),i=d.sortDescending;e.push(new sap.ui.model.Sorter(h,i))}c.sort(e)},handleDeclareSurplusDeliveryLineDialogOpen:function(){this._oRowActionsExtension.hideRowActions();var a=this.getView().byId("supplierOrdersTable").getSelectedItem().getBindingContext();if(a){this._oDeclareSurplusDeliveryLineDialog||(this._oDeclareSurplusDeliveryLineDialog=new sap.ui.xmlfragment("declareSurplusDeliveryLineFragment","com.zespri.awct.collab.fragment.DeclareSurplusForDeliveryLineDialog",this),this.getView().addDependent(this._oDeclareSurplusDeliveryLineDialog));var b=sap.ui.core.Fragment.byId("declareSurplusDeliveryLineFragment","surplusQuantityDeliveryLineInput");b.setValueState(sap.ui.core.ValueState.None),this._oDeclareSurplusDeliveryLineDialog.setBindingContext(a),b.getBinding("value").refresh(!0),this._oDeclareSurplusDeliveryLineDialog.open()}},handleDeclareSurplusDeliveryLineDialogClose:function(){this._oDeclareSurplusDeliveryLineDialog.close()},handleDeclareSurplusQuantityDeliveryLinePress:function(){var a=sap.ui.core.Fragment.byId("declareSurplusDeliveryLineFragment","surplusQuantityDeliveryLineInput"),b=a.getValue(),c=sap.ui.core.Fragment.byId("declareSurplusDeliveryLineFragment","suppliersDeliveryLineSelect"),d=c.getSelectedKey();if(isNaN(b)||Math.round(b)!==parseFloat(b)||parseInt(b,10)<0)a.setValueState(sap.ui.core.ValueState.Error),a.setValueStateText(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_SUPPLIERORDERS_SURPLUS_QUANTITY_ERROR_VALUE_STATE_TEXT"));else{a.setValueState(sap.ui.core.ValueState.None);var e=this._oDeclareSurplusDeliveryLineDialog;e.setBusy(!0);var f=this.byId("supplierOrdersTable"),g=this.byId("supplierOrdersTable").getSelectedItem().getBindingContext().getProperty("UOM");
this.getView().getModel().read("/SetSurplusForDeliveryLine",{urlParameters:{DeliveryLineID:"'"+this.byId("supplierOrdersTable").getSelectedItem().getBindingContext().getProperty("DeliveryLineID")+"'",DeliveryLineTimeStamp:com.zespri.awct.util.CommonFormatHelper.formatJSDateToEDMDateTimeString(this.byId("supplierOrdersTable").getSelectedItem().getBindingContext().getProperty("DeliveryLineUpdateTime")),Surplus:parseInt(b,10),SupplierID:"'"+d+"'"},success:function(){e.setBusy(!1),e.close();var a=com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_SUPPLIERORDERS_TOAST_SURPLUS_POSTED",[parseInt(b,10),g]);com.zespri.awct.util.NotificationHelper.showSuccessToast(a),f.getBinding("items").refresh()},error:function(a){e.setBusy(!1),com.zespri.awct.util.NotificationHelper.handleErrorMessage(a)}})}},handleViewTextsAndBatchCharacteristicsOpen:function(){var a=this;this._oRowActionsExtension.hideRowActions(),a._oViewTextsAndBatchCharacteristicsDialog||(a._oViewTextsAndBatchCharacteristicsDialog=new sap.ui.xmlfragment("viewTextAndBatchCharacteristicsFragment","com.zespri.awct.collab.fragment.ViewTextAndBatchCharacteristics",this),a._oViewTextsAndBatchCharacteristicsDialog.setModel(a.getView().getModel("i18n"),"i18n"));var b=this.getView().getModel(),c=a.getView().byId("supplierOrdersTable").getSelectedItem().getBindingContext(),d=c.getProperty("DeliveryLineID"),e=c+"/Text",f=c.getProperty("DeliveryID"),g="/DeliveryHeaderSet('"+f+"')/Text",h=function(b,c,d){com.zespri.awct.util.NotificationHelper.handleErrorMessage(d);var e=b.__batchResponses[0].data,f=new sap.ui.model.json.JSONModel;e&&f.setData(e),a._oViewTextsAndBatchCharacteristicsDialog.setModel(f);var g=f.getData().results.length;sap.ui.core.Fragment.byId("viewTextAndBatchCharacteristicsFragment","viewBatchCharacteristicsTableHeader").setText(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_TEXT_AND_BATCHCHARACTERISTICS_TABLE_TITLE",[g]));var h="";b.__batchResponses[1].data&&(h=b.__batchResponses[1].data.TextString),h&&0!==h.trim().length?sap.ui.core.Fragment.byId("viewTextAndBatchCharacteristicsFragment","viewItemLineTextText").setText(h).removeStyleClass("zAwctTextGrayItalics"):sap.ui.core.Fragment.byId("viewTextAndBatchCharacteristicsFragment","viewItemLineTextText").setText(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_LINE_TEXT_EMPTY")).addStyleClass("zAwctTextGrayItalics");var i="";b.__batchResponses[2].data&&(i=b.__batchResponses[2].data.TextString),i&&0!==i.trim().length?sap.ui.core.Fragment.byId("viewTextAndBatchCharacteristicsFragment","viewItemHeaderTextText").setText(i).removeStyleClass("zAwctTextGrayItalics"):sap.ui.core.Fragment.byId("viewTextAndBatchCharacteristicsFragment","viewItemHeaderTextText").setText(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_HEADER_TEXT_EMPTY")).addStyleClass("zAwctTextGrayItalics"),a._oViewTextsAndBatchCharacteristicsDialog.setBusy(!1),a._oViewTextsAndBatchCharacteristicsDialog.rerender()},i=function(a){sap.ui.core.Fragment.byId("viewTextAndBatchCharacteristicsFragment","viewItemLineTextText").setText(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_VIEW_LINE_TEXT_NO_VALUE")).addStyleClass("zAwctTextGrayItalics"),sap.ui.core.Fragment.byId("viewTextAndBatchCharacteristicsFragment","viewItemHeaderTextText").setText(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_VIEW_HEADER_TEXT_NO_VALUE")).addStyleClass("zAwctTextGrayItalics"),com.zespri.awct.util.NotificationHelper.handleErrorMessage(a)},j=b.createBatchOperation("BatchCharacteristicsSet?%24filter=DeliveryLineID%20eq%20%27"+d+"%27&%24expand=BatchCharacteristicsValueSet","GET"),k=b.createBatchOperation(e,"GET"),l=b.createBatchOperation(g,"GET"),m=[j,k,l];b.addBatchReadOperations(m),b.submitBatch(h,i),a._oViewTextsAndBatchCharacteristicsDialog.setBusy(!0),a._oViewTextsAndBatchCharacteristicsDialog.open()},handleViewTextAndBatchCharacteristicsOKPress:function(){this._oViewTextsAndBatchCharacteristicsDialog.close()},handleToolbarPress:function(){this.getRouter().navBack()},onExit:function(){this._oDeclareShortageDialog&&this._oDeclareShortageDialog.destroy(),this._oConfirmShortageDialog&&this._oConfirmShortageDialog.destroy(),this._oDeclareSurplusDialog&&this._oDeclareSurplusDialog.destroy(),this._oSettingsDialog&&this._oSettingsDialog.destroy(),this._oRowActionsExtension&&this._oRowActionsExtension.destroy()},formatBatchCharacteristicsValuesText:function(a){var b=function(a){return a.Value};return a.results.map(b).join(", ")},formatExcludeIncludeText:function(a){return a===com.zespri.awct.util.Enums.ViewBCOperation.Exclude?com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_TEXT_AND_BATCHCHARACTERISTICS_EXCLUDE"):a===com.zespri.awct.util.Enums.ViewBCOperation.Include?com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_TEXT_AND_BATCHCHARACTERISTICS_INCLUDE"):""},handleInitiateTradeDialogOpen:function(){this._oRowActionsExtension.hideRowActions();var a=this,b=this.byId("supplierOrdersTable").getSelectedItem().getBindingContext();if(b){this._oInitiateTradeDialog||(this._oInitiateTradeDialog=new sap.ui.xmlfragment("initiateTradeFragment","com.zespri.awct.collab.fragment.SupplierOrdersInitiateTradeDialog",this),this.getView().addDependent(this._oInitiateTradeDialog)),this._oInitiateTradeDialog.setBindingContext(b);var c=sap.ui.core.Fragment.byId("initiateTradeFragment","tradeSupplierSelect"),d=sap.ui.core.Fragment.byId("initiateTradeFragment","tradeQuantityInput");d.setValueState(sap.ui.core.ValueState.None),d.getBinding("value").refresh(!0),c.setSelectedKey(""),this._oInitiateTradeDialog.open(),this._oInitiateTradeDialog.setBusy(!0),com.zespri.awct.util.ModelHelper.getJSONModelForRead("/GetSuppliersForTrade",{urlParameters:{AllocationID:"'"+this._oInitiateTradeDialog.getBindingContext().getProperty("AllocationID")+"'"}},function(b){var d=b.getProperty("/results");d.unshift({Supplier:""}),b.setProperty("/results",d),c.setModel(b),c.bindItems({path:"/results",template:c.getBindingInfo("items")?c.getBindingInfo("items").template:c.getItems()[0].clone()}),a._oInitiateTradeDialog.setBusy(!1)},function(a){com.zespri.awct.util.NotificationHelper.handleErrorMessage(a)})}},handleInitiateTradeOkPress:function(){var a=sap.ui.core.Fragment.byId("initiateTradeFragment","tradeQuantityInput"),b=parseInt(a.getValue(),10),c=sap.ui.core.Fragment.byId("initiateTradeFragment","tradeSupplierSelect").getSelectedKey(),d=parseInt(this._oInitiateTradeDialog.getBindingContext().getProperty("Quantity"),10)-parseInt(this._oInitiateTradeDialog.getBindingContext().getProperty("TradeQuantity"),10),e=this._oInitiateTradeDialog.getBindingContext().getProperty("UOM"),f=this;if(isNaN(b)||0>=b)a.setValueState(sap.ui.core.ValueState.Error),a.setValueStateText(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_SUPPLIERORDERS_INITIATETRADE_TRADEQUANTITY_ERROR_VALUE_STATE_TEXT"));else if(b>d)a.setValueState(sap.ui.core.ValueState.Error),a.setValueStateText(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_SUPPLIERORDERS_INITIATETRADE_TRADEQUANTITY_EXCEED_STATE_TEXT",[d,e]));else{var g=this._oInitiateTradeDialog;g.setBusy(!0);var h=this.byId("supplierOrdersTable").getSelectedItem().getBindingContext().getObject(),i={ReceivingSupplierID:c,DeliveryLineID:h.DeliveryLineID,AllocationID:h.AllocationID,TradeQuantity:b+""};sap.ui.getCore().getRootComponent().getModel().create("/TradeSet",i,{success:function(){g.setBusy(!1),g.close(),com.zespri.awct.util.NotificationHelper.showSuccessToast(com.zespri.awct.util.I18NHelper.getText("TXT_COLLABORATION_SUPPLIERORDERS_TOAST_INITIATETRADE_SUCCESS_MESSAGE")),f.byId("supplierOrdersTable").getBinding("items").refresh()},error:function(a){g.setBusy(!1),com.zespri.awct.util.NotificationHelper.handleErrorMessage(a)},async:!0})}},handleInitiateTradeCancelPress:function(){this._oInitiateTradeDialog.close()},formatProductName:function(a,b,c,d,e,f,g,h,i){return a+"-"+b+"-"+c+"-"+d+"-"+e+"-"+f+"-"+g+"-"+h+"-"+i},formatCharacteristics:function(a,b,c){return a+b+c},handleExportAsCSVPressed:function(){var a="";a=this._sDownloadFilterString?this._sDownloadFilterString:this._createFilterString();var b=this.getView().getModel();b.setHeaders({BusinessAction:this._BusinessAction.DOWNLOAD,FileType:this._FileType.CSV}),this._oBusyDialog.open();var c=this;com.zespri.awct.util.ModelHelper.getJSONModelForRead("/CollaborationLineSet",{urlParameters:{$filter:a}},function(a){b.setHeaders(null),c._oBusyDialog.close();var d=a.getData().results[0].FileGuid;return 0!==parseInt(d,10)||isNaN(d)?(com.zespri.awct.util.NotificationHelper.showSuccessToast(com.zespri.awct.util.I18NHelper.getText("TXT_REPORTS_GENERATE_FORM_STARTING_DOWNLOAD_TOAST_MESSAGE")),void(window.location.href=window.location.protocol+"//"+window.location.host+"/sap/opu/odata/sap/Z_AWCT_SRV/FileDownloadSet('"+d+"')/$value")):void com.zespri.awct.util.NotificationHelper.showSuccessToast(com.zespri.awct.util.I18NHelper.getText("TXT_GENERIC_DOWNLOAD_NO_MATCHING_RESULTS_FOUND_MESSAGE"))},function(a){com.zespri.awct.util.NotificationHelper.handleErrorMessage(a),b.setHeaders(null),c._oBusyDialog.close()})},_createFilterString:function(){var a=this.byId("facetFilterCollaboration"),b=a.getLists(),c=!1,d=[];return $.each(b,function(a,b){if(b.getSelectedItems().length>0){var e=b.getKey(),f=b instanceof com.zespri.awct.control.FacetFilterDateInputList,g=b instanceof com.zespri.awct.control.FacetFilterNumberInputList,h=[];$.each(b.getSelectedItems(),function(a,b){var d=b.getKey();if("ShowDemandLines"===e&&(e="RecordType",d?c=!0:(d=com.zespri.awct.util.Enums.AllocationLineRecordType.SupplierOrderLine,c=!1)),f?d="datetime'"+d+"T00:00:00'":g||(d="'"+d+"'"),!c){var i=" eq ";("Shortage"===e||"Surplus"===e)&&(i=" gt ");var j=e+i+d;h.push(j)}}),c||d.push("("+h.join(" or ")+")")}}),d.join(" and ")}})}();