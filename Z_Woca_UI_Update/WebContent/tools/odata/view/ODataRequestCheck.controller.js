/*----------------------------------------------------------------------* 
 * Copyright  (c) 2014 SAP SE. All rights reserved	
 * Author       : SAP Custom Development 
 *----------------------------------------------------------------------*/ 
	!function(){"use strict";jQuery.sap.require({modName:"com.zespri.awct.core.Controller",type:"controller"}),jQuery.sap.require("com.zespri.awct.util.CommonHelper"),jQuery.sap.require("com.zespri.awct.util.CommonFormatHelper"),jQuery.sap.require("com.zespri.awct.util.Enums"),jQuery.sap.require("com.zespri.awct.util.I18NHelper"),jQuery.sap.require("com.zespri.awct.util.LocaleFormatHelper"),jQuery.sap.require("com.zespri.awct.util.ModelHelper"),jQuery.sap.require("com.zespri.awct.util.NotificationHelper"),com.zespri.awct.core.Controller.extend("com.zespri.awct.tools.odata.view.ODataRequestCheck",{onInit:function(){this._oDialogViewSettings=null,this._bUserAuthorized=!1;var a=this;a.getRouter().attachRoutePatternMatched(function(b){"Tools/OData"===b.getParameter("name")&&(a._bUserAuthorized?(a.oJsonRequestTable={},jQuery.ajax({url:"tools/odata/ODataRequests.json",headers:{"x-csrf-token":com.zespri.awct.util.CommonHelper.getCSRFToken()}}).done(function(b){var c=JSON.parse(b.replace(/!!STRDEL!!/gi,""));a.oJSONOdataRequest=c,a.getView().setModel(new sap.ui.model.json.JSONModel(c),"odataRequest");for(var d=a.oJSONOdataRequest.results[0],e=[],f,g=0;g<d.requests.length;g++)f=-1===d.requests[g].url.search("\\?")?d.requests[g].url+"?sap-statistics=true":d.requests[g].url+"&sap-statistics=true",e[g]=[],e[g].path=f,e[g].fullpath=d.baseURL+f,e[g].status=-1,e[g].gwtotal=0,e[g].gwhub=0,e[g].gwrfcoh=0,e[g].gwbe=0,e[g].gwapp=0;a.oJsonRequestTable={results:e};var h=e.length;a.getView().byId("odataRequestToolTableTitle").setText(com.zespri.awct.util.I18NHelper.getText("TXT_ODATAREQUESTCHECK_RESULT_TABLE_TITLE",[h])),a.getView().setModel(new sap.ui.model.json.JSONModel(a.oJsonRequestTable),"OdataRequestResultTable")})):com.zespri.awct.util.NotificationHelper.showErrorToast(com.zespri.awct.util.I18NHelper.getText("TXT_USER_NOT_AUTHORIZED_MESSAGE_TEXT")))},a)},onBeforeRendering:function(){com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Display,com.zespri.awct.util.Enums.AuthorizationObject.Administration,com.zespri.awct.util.Enums.AuthorizationFunctions.ZADM)?this._bUserAuthorized=!0:(this.byId("pageODataTool")&&this.byId("pageODataTool").destroy(),this._bUserAuthorized=!1)},getSelectedTableEntries:function(a,b){var c=this;c.oJsonRequestTable={};var d=[],e=0,f="",g=this.oJSONOdataRequest.results[0],h="";f=location.protocol+"//"+location.host+g.baseURL;for(var i=0;i<g.requests.length;i++)h=-1===g.requests[i].url.search("\\?")?g.requests[i].url+"?sap-statistics=true":g.requests[i].url+"&sap-statistics=true",("ALL"===a||g.requests[i].group===a)&&(d[e]=[],d[e].path=h,d[e].fullpath=f+h,d[e].status=b,d[e].gwtotal=0,d[e].gwhub=0,d[e].gwrfcoh=0,d[e].gwbe=0,d[e].gwapp=0,e++);c.oJsonRequestTable={results:d};var j=d.length;return c.getView().byId("odataRequestToolTableTitle").setText(com.zespri.awct.util.I18NHelper.getText("TXT_ODATAREQUESTCHECK_RESULT_TABLE_TITLE",[j])),c.getView().setModel(new sap.ui.model.json.JSONModel(c.oJsonRequestTable),"OdataRequestResultTable"),d},handleOdataRequestGroupSelectChange:function(a){var b=a.getParameters().selectedItem.getKey();this.getSelectedTableEntries(b,-1)},handleOdataRequestViewSettingDialogOKPress:function(a){var b=-2,c=[],d=a.getParameters();if(d.filterItems[0]){var e=d.filterItems[0].getKey();b=parseInt(e,10);var f=new sap.ui.model.Filter("status",sap.ui.model.FilterOperator.EQ,b);c.push(f)}var g=this.getView().byId("odataRequestToolTable").getBinding("items"),h=g.filter(c);if(d.sortItem){var i=d.sortItem.getKey(),j=d.sortDescending;g.sort(new sap.ui.model.Sorter(i,j))}var k=h.getLength();this.getView().byId("odataRequestToolTableTitle").setText(com.zespri.awct.util.I18NHelper.getText("TXT_ODATAREQUESTCHECK_RESULT_TABLE_TITLE",[k]))},handleOdataRequestToolCheckPress:function(){var a=this,b=a.getView().byId("odataRequestToolGroupSelect").getSelectedKey();a.getView().byId("odataRequestViewSettingDialogButton").setEnabled(!0);var c=a.getSelectedTableEntries(b,0);jQuery.each(c,function(b){var d="";d=c[b].fullpath.indexOf("?")>-1?c[b].fullpath+"&x-csrf-token="+com.zespri.awct.util.CommonHelper.getCSRFToken():c[b].fullpath+"?x-csrf-token="+com.zespri.awct.util.CommonHelper.getCSRFToken(),$.ajax({url:d,type:"GET",success:function(c,d,e){var f=[],g=e.getResponseHeader("sapgw-statistics"),h=a.getView().getModel("OdataRequestResultTable").getData();if(a.sSuccessStatusCode=e.status,a.sSuccessStatusText=e.statusText,g){for(var i=g.split("="),j=0;j<i.length;j++)for(var k=i[j].split(","),l=0;l<k.length;l++)"gwtotal"!==k[l]&&"gwhub"!==k[l]&&"gwrfcoh"!==k[l]&&"gwbe"!==k[l]&&"gwapp"!==k[l]&&f.push(k[l]);h.results[b].gwtotal=parseInt(f[0],10),h.results[b].gwhub=parseInt(f[1],10),h.results[b].gwrfcoh=parseInt(f[2],10),h.results[b].gwbe=parseInt(f[3],10),h.results[b].gwapp=parseInt(f[4],10)}h.results[b].status=1,a.getView().getModel("OdataRequestResultTable").setData(h)},error:function(c){a.sErrorStatusCode=c.status,a.sErrorStatusText=c.statusText;var d=a.getView().getModel("OdataRequestResultTable").getData();d.results[b].status=2,a.getView().getModel("OdataRequestResultTable").setData(d)}})})},handleOdataRequestViewSettingPress:function(){this._oDialogViewSettings||(this._oDialogViewSettings=sap.ui.xmlfragment("com.zespri.awct.tools.odata.fragment.ViewSettingsDialog",this),this.getView().addDependent(this._oDialogViewSettings)),this._oDialogViewSettings.open()},formatStatusCodeUpdate:function(a){var b="Not Started";return 1===a?b=this.sSuccessStatusCode:2===a?b=this.sErrorStatusCode:0===a&&(b="Pending"),b},formatStatusTextUpdate:function(a){var b="";return 1===a?b=this.sSuccessStatusText:2===a&&(b=this.sErrorStatusText),b},formatImageVisiblity:function(a){var b=!1;return 0===a&&(b=!0),b},formatStatusUpdateState:function(a){var b="None";return 1===a?b="Success":2===a&&(b="Error"),b}})}();