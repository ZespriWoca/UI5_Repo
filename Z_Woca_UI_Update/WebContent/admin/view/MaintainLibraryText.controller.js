/*----------------------------------------------------------------------* 
 * Copyright  (c) 2014 SAP SE. All rights reserved	
 * Author       : SAP Custom Development 
 *----------------------------------------------------------------------*/ 
	!function(){"use strict";jQuery.sap.require({modName:"com.zespri.awct.core.Controller",type:"controller"}),jQuery.sap.require("com.zespri.awct.util.CommonHelper"),jQuery.sap.require("com.zespri.awct.util.Enums"),jQuery.sap.require("com.zespri.awct.util.I18NHelper"),jQuery.sap.require("com.zespri.awct.util.LocaleFormatHelper"),jQuery.sap.require("com.zespri.awct.util.ModelHelper"),jQuery.sap.require("com.zespri.awct.util.NotificationHelper"),com.zespri.awct.core.Controller.extend("com.zespri.awct.admin.view.MaintainLibraryText",{onInit:function(){this._mSequenceChanges={},this._aChangedSequenceInputs=[],this._aLibraryTextListBatchChanges=[],this._aInValidSequenceChanges=[],this._bUserAuthorized=!1;var a=this,b=this.byId("LibraryTextMaintenaceTable");com.zespri.awct.util.CommonHelper.manageNoDataText(b),this.getRouter().attachRoutePatternMatched(function(b){if("Administration/MaintainLibraryText"===b.getParameter("name")){if(!a._bUserAuthorized)return void com.zespri.awct.util.NotificationHelper.showErrorToast(com.zespri.awct.util.I18NHelper.getText("TXT_USER_NOT_AUTHORIZED_MESSAGE_TEXT"));com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Maintain,com.zespri.awct.util.Enums.AuthorizationObject.Administration,com.zespri.awct.util.Enums.AuthorizationFunctions.ZADM)&&(a.byId("saveButton").setVisible(!0),a.byId("discardButton").setVisible(!0),a.byId("addTextButton").setVisible(!0),a.byId("sequenceInput")&&a.byId("sequenceInput").setEnabled(!0)),this._refreshTable()}},this)},onBeforeRendering:function(){com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Display,com.zespri.awct.util.Enums.AuthorizationObject.Administration,com.zespri.awct.util.Enums.AuthorizationFunctions.ZADM)?this._bUserAuthorized=!0:(this.byId("librarytextPage")&&this.byId("librarytextPage").destroy(),this._bUserAuthorized=!1)},_refreshTable:function(){var a=this.byId("LibraryTextMaintenaceTable");a.getBinding("items")?a.getBinding("items").refresh():a.bindItems({path:"/LibraryTextSet",template:a.getBindingInfo("items")?a.getBindingInfo("items").template:a.getItems()[0].clone()})},handleSequenceLiveChange:function(a){var b=a.getSource(),c=null,d=b.getValue(),e=b.getBindingContext(),f=e.getPath(),g=e.getProperty("Sequence");if(g===d){delete this._mSequenceChanges[f];var h=this._aInValidSequenceChanges.indexOf(b);return void(h>-1&&this._aInValidSequenceChanges.splice(h,1))}if(!d||isNaN(d))b.setValueState(sap.ui.core.ValueState.Error),b.setValueStateText(com.zespri.awct.util.I18NHelper.getText("TXT_ADMINISTARTION_SEQUENCE_ERROR_VALUE_STATE_TEXT")),this._aInValidSequenceChanges.push(b);else{var i=this._aInValidSequenceChanges.indexOf(b);i>-1&&this._aInValidSequenceChanges.splice(i,1),c={TextName:e.getProperty("TextName"),Sequence:parseInt(d,10)+"",Active:e.getProperty("Active"),Text:e.getProperty("Text")},b.setValueState(sap.ui.core.ValueState.None),this.setHasUnsavedChanges(!0),this._mSequenceChanges[f]=c}},handleViewDirtyStateChanged:function(a){a?(this.byId("saveButton").setEnabled(!0),this.byId("discardButton").setEnabled(!0)):(this.byId("saveButton").setEnabled(!1),this.byId("discardButton").setEnabled(!1))},handleSelectedLibraryText:function(){var a=this.byId("LibraryTextMaintenaceTable"),b=a.getSelectedItem().getBindingContext();b&&this.byId("detailsButton").setEnabled(!0)},handleAddLibraryText:function(){if(Object.keys(this._mSequenceChanges).length>0||this._aInValidSequenceChanges.length>0){var a=!0;return void this._save(a)}this.getRouter().navTo("Administration/MaintainLibraryTextDetail",{viewMode:com.zespri.awct.util.Enums.ViewMode.Add})},_save:function(a){var b=this;if(this._aInValidSequenceChanges.length>0){var c=com.zespri.awct.util.I18NHelper.getText("TXT_ADMINISTARTION_SEQUENCE_ERROR_VALUE_STATE_TEXT_BEFORE_SAVE_TOAST");return void com.zespri.awct.util.NotificationHelper.showErrorToast(c)}var d=[],e=this.getView().getModel();jQuery.each(this._mSequenceChanges,function(a,b){var c=e.createBatchOperation(a,"PUT",b);d.push(c)}),this._setViewBusy(!0);var f=b.byId("LibraryTextMaintenaceTable"),g=f.getSelectedItem().getBindingContext(),h=function(){b.getRouter().navTo("Administration/MaintainLibraryTextDetail",{contextPath:g.getPath().substr(1),viewMode:com.zespri.awct.util.Enums.ViewMode.Modify},!1),f.detachUpdateFinished(h)};e.addBatchChangeOperations(d),e.submitBatch(function(c,d,e){var f=com.zespri.awct.util.NotificationHelper.handleErrorMessage(e);if(jQuery.sap.log.info("Administration : Batch update was successful."),b.setHasUnsavedChanges(!1),b._aInValidSequenceChanges=[],b._mSequenceChanges={},b._setViewBusy(!1),!f){var g=com.zespri.awct.util.I18NHelper.getText("TXT_ADMINISTARTION_SUCCESS_SAVE_TOAST");com.zespri.awct.util.NotificationHelper.showSuccessToast(g)}a&&b.byId("LibraryTextMaintenaceTable").attachUpdateFinished(h)},function(a){jQuery.sap.log.error("Administration : Batch update failed."),com.zespri.awct.util.NotificationHelper.handleErrorMessage(a),b._setViewBusy(!1)})},handelSaveChanges:function(){var a=!1;this._save(a)},handleLibraryTextSearch:function(a){if(Object.keys(this._mSequenceChanges).length>0||this._aInValidSequenceChanges.length>0){var b=com.zespri.awct.util.I18NHelper.getText("TXT_ADMINISTARTION_LIBRARY_TEXT_SEARCH_DISCARD_CHANGES_TOAST");return void com.zespri.awct.util.NotificationHelper.showSuccessToast(b)}var c=[],d=a.getSource().getValue();if(d&&d.length>0){var e=new sap.ui.model.Filter("TextName",sap.ui.model.FilterOperator.Contains,d);c.push(e)}this.byId("LibraryTextMaintenaceTable").getBinding("items").filter(c)},handleLibraryTextTableUpdateFinished:function(a){var b=a.getSource(),c=b.getItems();c.length<0&&this.getView().byId("detailsButton").setEnabled(!1)},handleDeatilPageNavigation:function(){var a=this.byId("LibraryTextMaintenaceTable"),b=a.getSelectedItem().getBindingContext();if(Object.keys(this._mSequenceChanges).length>0||this._aInValidSequenceChanges.length>0){var c=!0;this._save(c)}else this.getRouter().navTo("Administration/MaintainLibraryTextDetail",{contextPath:b.getPath().substr(1),viewMode:com.zespri.awct.util.Enums.ViewMode.Modify})},_setViewBusy:function(a){this.getView().setBusy(a),this.byId("librarytextPage").getFooter().setBusy(a)},handelDiscardChanges:function(){var a=com.zespri.awct.util.I18NHelper.getText("TXT_ADMINISTRATION_LIBRARY_TEXT_CONFIRM_DELETE"),b=function(){this._refreshTable(),this._aInValidSequenceChanges=[],this._mSequenceChanges={},this.setHasUnsavedChanges(!1)};com.zespri.awct.util.NotificationHelper.showConfirmDialog(a,$.proxy(b,this))}})}();