/*----------------------------------------------------------------------* 
 * Copyright  (c) 2014 SAP SE. All rights reserved	
 * Author       : SAP Custom Development 
 *----------------------------------------------------------------------*/ 
	!function(){"use strict";jQuery.sap.require({modName:"com.zespri.awct.core.Controller",type:"controller"}),jQuery.sap.require("com.zespri.awct.util.CommonHelper"),jQuery.sap.require("com.zespri.awct.util.Enums"),jQuery.sap.require("com.zespri.awct.util.I18NHelper"),jQuery.sap.require("com.zespri.awct.util.LocaleFormatHelper"),jQuery.sap.require("com.zespri.awct.util.ModelHelper"),jQuery.sap.require("com.zespri.awct.util.NotificationHelper"),com.zespri.awct.core.Controller.extend("com.zespri.awct.admin.view.ExceptionRateMaintenance",{onInit:function(){this._oFilter=null;var a=this,b=this.byId("exceptionRateTable"),c=this.byId("facetFilterExceptionRateMaintenance");com.zespri.awct.util.CommonHelper.manageFacetFilterState(b,c),com.zespri.awct.util.CommonHelper.manageNoDataText(b),this.getRouter().attachRoutePatternMatched(function(c){if("Administration/ExceptionRateMaintenance"===c.getParameter("name"))if(a._bUserAuthorized){var d=c.getParameter("arguments").customData;if(d)if(d.ScheduleName){var e={};e[d.ScheduleName]=d.ScheduleName,a.byId("scheduleNameFacetList").setSelectedKeys(e),a._bindItemsToSeasonFacetList()}else{var f=c.getParameter("arguments").customData.noTableRefresh;f||b.getBinding("items").refresh(!0)}else b.getBinding("items")||a._bindItemsToSeasonFacetList()}else com.zespri.awct.util.NotificationHelper.showErrorToast(com.zespri.awct.util.I18NHelper.getText("TXT_USER_NOT_AUTHORIZED_MESSAGE_TEXT"))})},onBeforeRendering:function(){com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Display,com.zespri.awct.util.Enums.AuthorizationObject.Administration,com.zespri.awct.util.Enums.AuthorizationFunctions.ZADM)?this._bUserAuthorized=!0:(this.byId("pageExceptionRates")&&this.byId("pageExceptionRates").destroy(),this._bUserAuthorized=!1)},_bindItemsToSeasonFacetList:function(){var a=sap.ui.getCore().getRootComponent().getApplicationParameters().CurrentSeason,b=this,c=b.byId("exceptionRateTable");c.setBusy(!0);var d=this.byId("seasonFacetList");d.setBusy(!0),com.zespri.awct.util.ModelHelper.getJSONModelForRead("/GenericSearchSet",{urlParameters:{$filter:"Scenario eq 'SEASON'"}},function(e){d.setModel(e),d.bindItems({path:"/results",template:d.getBindingInfo("items")?d.getBindingInfo("items").template:d.getItems()[0].clone()});var f={};f[a]=a,d.getItems().length&&d.setSelectedKeys(f),d.setBusy(!1),b._oFilter=b._getFacetFilterObject(),c.bindAggregation("items",{path:"/ExceptionRateSet",filters:[b._oFilter],template:c.getBindingInfo("items")?c.getBindingInfo("items").template:c.getItems()[0].clone()}),c.setBusy(!1)},function(a){com.zespri.awct.util.NotificationHelper.handleErrorMessage(a)})},_getFacetFilterObject:function(){var a=this.byId("facetFilterExceptionRateMaintenance"),b=a.getLists().filter(function(a){return a.getActive()&&a.getSelectedItems().length}),c=new sap.ui.model.Filter(b.map(function(a){return new sap.ui.model.Filter(a.getSelectedItems().map(function(b){var c=a.getKey(),d=b.getKey(),e=null;switch(c){case"Active":d=b.getKey()?!0:!1,e=new sap.ui.model.Filter(c,"EQ",d);break;default:e=new sap.ui.model.Filter(c,"EQ",d)}return e}),!1)}),!0);return c},handleAddExceptionRatePress:function(){this.getRouter().navTo("Administration/ExceptionRateDetail",{viewMode:com.zespri.awct.util.Enums.ViewMode.Add})},handleExceptionRateTableSelect:function(a){var b=a.getSource().getSelectedItem(),c=b.getBindingContextPath();this.getRouter().navTo("Administration/ExceptionRateDetail",{contextPath:c.substr(1),viewMode:com.zespri.awct.util.Enums.ViewMode.Modify})},handleFacetFilterReset:function(){for(var a=this.byId("facetFilterExceptionRateMaintenance"),b=a.getLists(),c=0;c<b.length;c++)b[c].setSelectedKeys();var d=sap.ui.getCore().getRootComponent().getApplicationParameters().CurrentSeason,e=this.byId("seasonFacetList"),f={};f[d]=d,e.getItems().length&&e.setSelectedKeys(f);var g=this._getFacetFilterObject();this._applyFilter(g)},_applyFilter:function(a){var b=this.byId("exceptionRateTable");b.setBusy(!0),b.getBinding("items").filter(a,sap.ui.model.FilterType.Application),b.setBusy(!1),this._oFilter=a},handleFacetListClose:function(a){if(a.getSource().getId()===this.createId("seasonFacetList")){var b=a.getSource(),c=b.getSelectedItems().length;if(!c){var d={},e=sap.ui.getCore().getRootComponent().getApplicationParameters().CurrentSeason;d[e]=e,b.setSelectedKeys(d)}}var f=this.byId("facetFilterExceptionRateMaintenance");if(f.getFiltersModifiedAfterListOpen()){var g=this._getFacetFilterObject();this._applyFilter(g)}},handleListOpen:function(a){var b=a.getSource().getKey(),c={};switch(b){case"ShipmentType":var d=sap.ui.getCore().getRootComponent().getApplicationParameters().CurrentSeason;c.facetListControl=this.byId("shipmentTypeFacetList"),c.entitySetName="GetShipmentTypesForDifotis",c.urlParameter={Season:"'"+d+"'"},com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!1);break;case"Characteristic/Variety":c.facetListControl=this.byId("varietyFacetList"),c.entitySetName="GenericSearchSet",c.filterString="Scenario eq 'VARIETY'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!1);break;case"Characteristic/Class":c.facetListControl=this.byId("classFacetList"),c.entitySetName="GenericSearchSet",c.filterString="Scenario eq 'CLASS'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!1);break;case"Characteristic/GrowingMethod":c.facetListControl=this.byId("growingMethodFacetList"),c.entitySetName="GenericSearchSet",c.filterString="Scenario eq 'GROWING_METHOD'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!1);break;case"Season":c.facetListControl=this.byId("seasonFacetList"),c.entitySetName="GenericSearchSet",c.filterString="Scenario eq 'SEASON'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!1);break;case"ChargeCode":c.facetListControl=this.byId("chargeCodeFacetList"),c.entitySetName="GenericSearchSet",c.filterString="Scenario eq 'CHARGECODE'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!1);break;case"ScheduleName":c.facetListControl=this.byId("scheduleNameFacetList"),c.entitySetName="ScheduleSet",c.selectString="ScheduleName",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!1);break;case"DeliveryID":c.facetListControl=this.byId("DeliveryNoFacetList"),c.entitySetName="DeliveryHeaderSet",c.selectString="DeliveryHeaderID",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!1)}},formatShortNoticeFlagValue:function(a){return com.zespri.awct.util.I18NHelper.getText(a?"TXT_GENERIC_YES":"TXT_GENERIC_NO")}})}();