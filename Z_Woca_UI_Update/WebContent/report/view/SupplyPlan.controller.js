/*----------------------------------------------------------------------* 
 * Copyright  (c) 2014 SAP SE. All rights reserved	
 * Author       : SAP Custom Development 
 *----------------------------------------------------------------------*/ 
	!function(){"use strict";jQuery.sap.require({modName:"com.zespri.awct.core.Controller",type:"controller"}),jQuery.sap.require("com.zespri.awct.util.CommonHelper"),jQuery.sap.require("com.zespri.awct.util.I18NHelper"),jQuery.sap.require("com.zespri.awct.util.CommonFormatHelper"),jQuery.sap.require("com.zespri.awct.util.LocaleFormatHelper"),jQuery.sap.require("com.zespri.awct.util.ModelHelper"),com.zespri.awct.core.Controller.extend("com.zespri.awct.report.view.SupplyPlan",{onInit:function(){this._oFilter=null;var a=this,b=this.byId("viewAllocationShareTable"),c=this.byId("viewRatioPerSizeTable");com.zespri.awct.util.CommonHelper.manageNoDataText(b),com.zespri.awct.util.CommonHelper.manageNoDataText(c),this.getRouter().attachRoutePatternMatched(function(d){if("Reports/SupplyPlan"===d.getParameter("name"))if(b.getBinding("items")||c.getBinding("items")){var e=null;switch(a.byId("supplyPlanIconTabBar").getSelectedKey()){case"ViewAllocationShare":e=b;break;case"ViewRatioPerSize":e=c}e.getBinding("items").refresh(!0)}else b.bindAggregation("items",{path:"/CollaborationLineSet",template:b.getItems()[0].clone()})},this)},handleListOpen:function(a){var b=a.getSource().getKey(),c={};switch(b){case"Season":c.facetListControl=this.byId("facetFilterListSupplyPlanSeason"),c.entitySetName="GenericSearchSet",c.filterString="Scenario eq 'SEASON'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!1);break;case"SupplierID":c.facetListControl=this.byId("facetFilterListSupplyPlanSupplier"),c.entitySetName="SupplierSet",c.selectString="SupplierID",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!1);break;case"D3_ItemGroup":c.facetListControl=this.byId("facetFilterListSupplyPlanItemGroup"),c.entitySetName="GenericSearchSet",c.filterString="Scenario eq 'ITEM_GROUP'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!1);break;case"D3_LoadPort":c.facetListControl=this.byId("facetFilterListSupplyPlanLoadPort"),c.entitySetName="PortSet",c.filterString="PortType eq 'L'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!1);break;case"D3_Origin":c.facetListControl=this.byId("facetFilterListSupplyPlanOrigin"),c.entitySetName="GenericSearchSet",c.filterString="Scenario eq 'ORIGIN'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!1);break;case"D3_Characteristics/Variety":c.facetListControl=this.byId("facetFilterListSupplyPlanVariety"),c.entitySetName="GenericSearchSet",c.filterString="Scenario eq 'VARIETY'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!1);break;case"D3_Characteristics/Class":c.facetListControl=this.byId("facetFilterListSupplyPlanClass"),c.entitySetName="GenericSearchSet",c.filterString="Scenario eq 'CLASS'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!1);break;case"D3_Characteristics/GrowingMethod":c.facetListControl=this.byId("facetFilterListSupplyPlanGrowingMethod"),c.entitySetName="GenericSearchSet",c.filterString="Scenario eq 'GROWING_METHOD'",com.zespri.awct.util.CommonHelper.createFacetFilterListItems(c,!1)}},handleListClose:function(){var a=this.byId("facetFilterSupplyPlan");a.getFiltersModifiedAfterListOpen()&&this._applyFacetFilters()},handleFacetFilterReset:function(){for(var a=this.byId("facetFilterSupplyPlan"),b=a.getLists(),c=0;c<b.length;c++)b[c].setSelectedKeys();var d=this._getCurrentTable();d.getBinding("items").filter([],sap.ui.model.FilterType.Application),this._oFilter=null},_getCurrentTable:function(){var a=null;switch(this.byId("supplyPlanIconTabBar").getSelectedKey()){case"ViewAllocationShare":a=this.byId("viewAllocationShareTable");break;case"ViewRatioPerSize":a=this.byId("viewRatioPerSizeTable")}return a},handleNavigateToAnotherTab:function(){var a=this;if("ViewRatioPerSize"===a.byId("supplyPlanIconTabBar").getSelectedKey())if(a.byId("viewRatioPerSizeTable").getBinding("items"))this._applyFacetFilters(this._oFilter);else{var b={path:"/AllocationLineSet",template:a.byId("viewRatioPerSizeTable").getItems()[0].clone()};this._oFilter&&(b.filters=[this._oFilter]),a.byId("viewRatioPerSizeTable").bindAggregation("items",b)}else this._applyFacetFilters(this._oFilter)},_applyFacetFilters:function(a){var b=this._getCurrentTable();if(a)b.getBinding("items").filter(a,sap.ui.model.FilterType.Application);else{var c=this.byId("facetFilterSupplyPlan"),d=c.getLists().filter(function(a){return a.getActive()&&a.getSelectedItems().length}),e=new sap.ui.model.Filter(d.map(function(a){return new sap.ui.model.Filter(a.getSelectedItems().map(function(b){var c=a.getKey(),d=b.getKey(),e=new sap.ui.model.Filter(c,"EQ",d);return e}),!1)}),!0);e.aFilters.length||(e=null),b.getBinding("items").filter(e,sap.ui.model.FilterType.Application),this._oFilter=e}}})}();