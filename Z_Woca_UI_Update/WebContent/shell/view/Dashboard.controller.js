/*----------------------------------------------------------------------* 
 * Copyright  (c) 2014 SAP SE. All rights reserved	
 * Author       : SAP Custom Development 
 *----------------------------------------------------------------------*/ 
	!function(){"use strict";jQuery.sap.require({modName:"com.zespri.awct.core.Controller",type:"controller"}),jQuery.sap.require("com.zespri.awct.util.Enums"),jQuery.sap.require("com.zespri.awct.util.I18NHelper"),jQuery.sap.require("com.zespri.awct.util.NotificationHelper"),jQuery.sap.require("com.zespri.awct.util.LocaleFormatHelper"),com.zespri.awct.core.Controller.extend("com.zespri.awct.shell.view.Dashboard",{onInit:function(){this._aTilesOrder=["charterShortage","charterSurplus","containerShortage","containerSurplus","lockedDeliveries","supplyGTDemand","inBoundTradeOpportunities","openTradeOpportunities","fullfillOrder","shipmentConfirmationDueTodayCharter","shipmentConfirmationDueTodayContainer","shipmentConfirmationDueTomorrowCharter","shipmentConfirmationDueTomorrowContainer"],this._aInactiveTiles=[],this._CharterOrContainer={Charter:"01",Container:"02"},this._aShipmentsDueToday=[],this._aShipmentsDueTomorrow=[],this._oBusyDialog=new sap.m.BusyDialog;var a=this;this._oBusyDialog.open(),this.getRouter().attachRoutePatternMatched(function(b){"/"===b.getParameter("name")&&a._resetTileContainerModel()})},_resetTileContainerModel:function(){var a=this,b={},c=this.getView().getModel(),d=function(b){com.zespri.awct.util.NotificationHelper.handleErrorMessage(b),a._oBusyDialog.close()},e=function(c,d,e){var f=[];com.zespri.awct.util.NotificationHelper.handleErrorMessage(e),c.__batchResponses[0].data&&(f=c.__batchResponses[0].data.results);for(var g=0;g<f.length;g++){var h=com.zespri.awct.util.LocaleFormatHelper.formatQuantity(f[g].Count),i=com.zespri.awct.util.LocaleFormatHelper.formatQuantity(f[g].PalletQuantity);switch(f[g].TileScenario){case"01":b.charterShortage={sId:"charterShortageTile",number:h,numberUnit:"",icon:"sap-icon://sys-minus",title:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_TITLE_CHARTER_SHORTAGE"),infoState:"None",info:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_PALLET_COUNT_TEXT",[i])};break;case"02":b.charterSurplus={sId:"charterSurplusTile",number:h,numberUnit:"",icon:"sap-icon://sys-add",title:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_TITLE_CHARTER_SURPLUS"),infoState:"None",info:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_PALLET_COUNT_TEXT",[i])};break;case"03":b.containerShortage={sId:"containerShortageTile",number:h,numberUnit:"",icon:"sap-icon://sys-minus",title:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_TITLE_CONTAINER_SHORTAGE"),infoState:"None",info:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_PALLET_COUNT_TEXT",[i])};break;case"04":b.containerSurplus={sId:"containerSurplusTile",number:h,numberUnit:"",icon:"sap-icon://sys-add",title:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_TITLE_CONTAINER_SURPLUS"),infoState:"None",info:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_PALLET_COUNT_TEXT",[i])};break;case"05":b.lockedDeliveries={sId:"lockedDeliveriesTile",number:h,numberUnit:"",icon:"sap-icon://locked",title:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_TITLE_LOCKED_DELIVERIES"),infoState:"None",info:""};break;case"06":b.supplyGTDemand={sId:"supplyGTDemandTile",number:h,numberUnit:"",icon:"sap-icon://positive",title:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_TITLE_SUPPLY_GT_DEMAND"),infoState:"None",info:""};break;case"07":b.inBoundTradeOpportunities={sId:"inBoundTradeOpportunitiesTile",number:h,numberUnit:"",icon:"sap-icon://arrow-bottom",title:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_TITLE_INBOUND_TRADE_OPPORTUNITIES"),infoState:"None",info:""};break;case"09":b.fullfillOrder={sId:"fullfillOrderTile",number:h,numberUnit:"",icon:"sap-icon://activity-2",title:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_TITLE_FULFILL_ORDER"),infoState:"None",info:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_PALLET_COUNT_TEXT",[i])};break;case"11":b.openTradeOpportunities={sId:"openTradeOpportunitiesTile",number:h,numberUnit:"",icon:"sap-icon://display-more",title:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_TITLE_OPEN_TRADE_OPPORTUNITIES"),infoState:"None",info:""}}}if(c.__batchResponses[1]){a._aShipmentsDueTodayCharter=[],a._aShipmentsDueTomorrowCharter=[],a._aShipmentsDueTodayContainer=[],a._aShipmentsDueTomorrowContainer=[];var j=[];c.__batchResponses[1].data&&(j=c.__batchResponses[1].data.results);for(var k=0;k<j.length;k++)j[k].DueTodayFlag&&j[k].CharterOrContainer===a._CharterOrContainer.Charter&&a._aShipmentsDueTodayCharter.push(j[k].ShipmentID),j[k].DueTomorrowFlag&&j[k].CharterOrContainer===a._CharterOrContainer.Charter&&a._aShipmentsDueTomorrowCharter.push(j[k].ShipmentID),j[k].DueTodayFlag&&j[k].CharterOrContainer===a._CharterOrContainer.Container&&a._aShipmentsDueTodayContainer.push(j[k].ShipmentID),j[k].DueTomorrowFlag&&j[k].CharterOrContainer===a._CharterOrContainer.Container&&a._aShipmentsDueTomorrowContainer.push(j[k].ShipmentID);var l=com.zespri.awct.util.LocaleFormatHelper.formatQuantity(a._aShipmentsDueTodayCharter.length);b.shipmentConfirmationDueTodayCharter={sId:"shipmentConfirmationDueTodayCharterTile",number:l,numberUnit:"",icon:"sap-icon://flag",title:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_TITLE_SHIPMENT_CONFIRMATIONS_DUE_CHARTER"),infoState:"Warning",info:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_TITLE_SHIPMENT_CONFIRMATIONS_DUE_TODAY")};var m=com.zespri.awct.util.LocaleFormatHelper.formatQuantity(a._aShipmentsDueTomorrowCharter.length);b.shipmentConfirmationDueTomorrowCharter={sId:"shipmentConfirmationDueTomorrowCharterTile",number:m,numberUnit:"",icon:"sap-icon://flag",title:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_TITLE_SHIPMENT_CONFIRMATIONS_DUE_CHARTER"),infoState:"None",info:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_TITLE_SHIPMENT_CONFIRMATIONS_DUE_TOMORROW")};var n=com.zespri.awct.util.LocaleFormatHelper.formatQuantity(a._aShipmentsDueTodayContainer.length);b.shipmentConfirmationDueTodayContainer={sId:"shipmentConfirmationDueTodayContainerTile",number:n,numberUnit:"",icon:"sap-icon://flag",title:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_TITLE_SHIPMENT_CONFIRMATIONS_DUE_CONTAINER"),infoState:"Warning",info:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_TITLE_SHIPMENT_CONFIRMATIONS_DUE_TODAY")};var o=com.zespri.awct.util.LocaleFormatHelper.formatQuantity(a._aShipmentsDueTomorrowContainer.length);b.shipmentConfirmationDueTomorrowContainer={sId:"shipmentConfirmationDueTomorrowContainerTile",number:o,numberUnit:"",icon:"sap-icon://flag",title:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_TITLE_SHIPMENT_CONFIRMATIONS_DUE_CONTAINER"),infoState:"None",info:com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_TITLE_SHIPMENT_CONFIRMATIONS_DUE_TOMORROW")}}$.each(b,function(c,d){if(!parseInt(d.number,10)){var e=d.sId.replace("Tile","");b[e].type=sap.m.StandardTileType.Monitor,a._aInactiveTiles.push(e)}});var p=a.byId("tileContainer"),q=new sap.ui.model.json.JSONModel;q.setData(b),p.setModel(q),a._addTilesToContainer(),a._oBusyDialog.close()},f=c.createBatchOperation("GetTilesCount","GET"),g=[f];if(com.zespri.awct.util.CommonHelper.isUserAuthorized(com.zespri.awct.util.Enums.AuthorizationMode.Maintain,com.zespri.awct.util.Enums.AuthorizationObject.Collaboration,com.zespri.awct.util.Enums.AuthorizationFunctions.ZSUP)){var h=c.createBatchOperation("GetShipmentConfirmDue","GET");g.push(h)}c.addBatchReadOperations(g),c.submitBatch(e,d)},_addTilesToContainer:function(){var a=this;this._bTileCreated=!0;for(var b=this._aTilesOrder.slice(),c=0;c<this._aInactiveTiles.length;c++){var d=b.indexOf(this._aInactiveTiles[c]);d>-1&&b.splice(d,1)}b=b.concat(this._aInactiveTiles),this._aInactiveTiles=[];var e=this.byId("tileContainer").getModel().getData(),f=this.byId("tileContainer");f.destroyTiles(),$.each(b,function(b,c){var d=e[c];if(e[c]){var g=d.sId,h=d.type;h||(h=sap.m.StandardTileType.None);var i=new sap.m.StandardTile(g,{title:d.title,number:d.number,numberUnit:d.numberUnit,icon:d.icon,infoState:d.infoState,info:d.info,type:h,press:function(b){a.handleTilePress(b)}});f.addTile(i)}})},handleTilePress:function(a){var b=this,c=a.getParameter("id"),d=parseInt(a.getSource().getProperty("number"),10);if("charterShortageTile"===c)this.getRouter().navTo("Collaboration/SupplierOrders",{customData:{filters:{Shortage:0,CharterOrContainer:b._CharterOrContainer.Charter}}});else if("charterSurplusTile"===c)this.getRouter().navTo("Collaboration/SupplierOrders",{customData:{filters:{Surplus:0,CharterOrContainer:b._CharterOrContainer.Charter}}});else if("containerShortageTile"===c)this.getRouter().navTo("Collaboration/SupplierOrders",{customData:{filters:{Shortage:0,CharterOrContainer:b._CharterOrContainer.Container}}});else if("containerSurplusTile"===c)this.getRouter().navTo("Collaboration/SupplierOrders",{customData:{filters:{Surplus:0,CharterOrContainer:b._CharterOrContainer.Container}}});else if("lockedDeliveriesTile"===c)this.getRouter().navTo("Allocation/DeliveryWorkList",{customData:{filters:{Status:[com.zespri.awct.util.Enums.DeliveryStatus.Locked]}}});else if("supplyGTDemandTile"===c)this.getRouter().navTo("Allocation/DeliveryWorkList",{customData:{filters:{Status:[com.zespri.awct.util.Enums.DeliveryStatus.Released,com.zespri.awct.util.Enums.DeliveryStatus.Locked],IsSupplyGtDemandFlag:!0}}});else if("openTradeOpportunitiesTile"===c)this.getRouter().navTo("Collaboration/TradeOpportunities",{customData:{filters:{Status:com.zespri.awct.util.Enums.TradeStatus.Initiated,Type:com.zespri.awct.util.Enums.TradeType.Open}}});else if("shipmentConfirmationDueTodayCharterTile"===c){if(0>=d){var e=com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_SHIPMENT_CONFIRMATIONS_DUE_TODAY_INACTIVE_TOAST");return void com.zespri.awct.util.NotificationHelper.showErrorToast(e)}this.getRouter().navTo("Collaboration/SupplierOrders",{customData:{filters:{CharterOrContainer:b._CharterOrContainer.Charter,ShipmentID:b._aShipmentsDueTodayCharter}}})}else if("shipmentConfirmationDueTomorrowCharterTile"===c){if(0>=d){var f=com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_SHIPMENT_CONFIRMATIONS_DUE_TOMORROW_INACTIVE_TOAST");return void com.zespri.awct.util.NotificationHelper.showErrorToast(f)}this.getRouter().navTo("Collaboration/SupplierOrders",{customData:{filters:{CharterOrContainer:b._CharterOrContainer.Charter,ShipmentID:b._aShipmentsDueTomorrowCharter}}})}else if("shipmentConfirmationDueTodayContainerTile"===c){if(0>=d){var g=com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_SHIPMENT_CONFIRMATIONS_DUE_TODAY_INACTIVE_TOAST");return void com.zespri.awct.util.NotificationHelper.showErrorToast(g)}this.getRouter().navTo("Collaboration/SupplierOrders",{customData:{filters:{CharterOrContainer:b._CharterOrContainer.Container,ShipmentID:b._aShipmentsDueTodayContainer}}})}else if("shipmentConfirmationDueTomorrowContainerTile"===c){if(0>=d){var h=com.zespri.awct.util.I18NHelper.getText("TXT_DASHBOARD_TILE_SHIPMENT_CONFIRMATIONS_DUE_TOMORROW_INACTIVE_TOAST");return void com.zespri.awct.util.NotificationHelper.showErrorToast(h)}this.getRouter().navTo("Collaboration/SupplierOrders",{customData:{filters:{CharterOrContainer:b._CharterOrContainer.Container,ShipmentID:b._aShipmentsDueTomorrowContainer}}})}else"fullfillOrderTile"===c?this.getRouter().navTo("Collaboration/SupplierOrders",{customData:{filters:{RecordType:com.zespri.awct.util.Enums.AllocationLineRecordType.SupplierOrderLine}}}):"inBoundTradeOpportunitiesTile"===c&&this.getRouter().navTo("Collaboration/TradeOpportunities",{customData:{filters:{Status:com.zespri.awct.util.Enums.TradeStatus.Initiated,Type:com.zespri.awct.util.Enums.TradeType.Inbound}}})}})}();